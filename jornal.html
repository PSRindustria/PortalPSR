<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <meta name="robots" content="noindex, nofollow">
  <link rel="icon" href="favicon.png" type="image/png">
  <meta property="og:title" content="Portal PSR">
  <meta property="og:description" content="Jornal PSR">
  <meta property="og:image" content="https://i.postimg.cc/y602YBCK/0-CAPA.jpg">
  <meta property="og:url" content="https://psrindustria.github.io/PortalPSR/">
  <meta property="og:type" content="website">
  <title>PSR Indústria - Jornal PSR</title>
  <!-- CSS principal -->
  <link rel="stylesheet" href="style.css" />
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <style>
    /* reset básico */
    html, body { margin: 0; padding: 0; height: 100%; background: #e0e0e0; font-family: sans-serif; }
    main {
      margin-top: 50px;
      margin-bottom: 0;
      padding-bottom: 0;
      text-align: center;
      position: relative;
      padding-top: 30px;
      height: calc(100vh - 80px);
      overflow: hidden;
    }

    /* --- Controles flutuantes --- */
    .viewer-controls {
      position: fixed;
      top: 50%;
      right: 20px;
      transform: translateY(-50%);
      display: flex;
      flex-direction: column;
      gap: 10px;
      padding: 15px;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(10px);
      border-radius: 15px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.3);
      z-index: 1000;
      transition: all 0.3s ease;
      opacity: 0.6;
      scale: 0.85;
    }
    .viewer-controls:hover { opacity: 1; scale: 1; background: rgba(0, 0, 0, 0.85); }

    .viewer-controls.book-mode-controls {
      position: fixed;
      top: 20px;
      left: 50%;
      right: auto;
      transform: translateX(-50%);
      flex-direction: row;
      gap: 15px;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      opacity: 0.9;
      scale: 1;
      border: 1px solid #ccc;
    }
    .viewer-controls.book-mode-controls:hover { background: rgba(255, 255, 255, 1); opacity: 1; }

    .control-btn {
      background: rgba(255, 255, 255, 0.9);
      color: #333;
      border: none;
      padding: 8px 10px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.3s ease;
      backdrop-filter: blur(5px);
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .control-btn:hover { background: rgba(255, 255, 255, 1); transform: translateY(-1px); box-shadow: 0 4px 12px rgba(0,0,0,0.2); }
    .control-btn:disabled { background: rgba(255, 255, 255, 0.5); color: #999; cursor: not-allowed; transform: none; }

    .book-mode-controls .control-btn { background: #333; color: #fff; padding: 10px 15px; font-size: 16px; }
    .book-mode-controls .control-btn:hover { background: #555; }
    .book-mode-controls .control-btn:disabled { background: #ccc; color: #999; }

    .mode-toggle { background: #007bff !important; color: #fff !important; font-size: 12px; padding: 6px 10px; }
    .book-mode-controls .mode-toggle { background: #007bff !important; font-size: 14px; padding: 8px 12px; }

    .page-counter {
      background: rgba(255, 255, 255, 0.9);
      color: #333;
      padding: 6px 10px;
      border-radius: 8px;
      font-weight: bold;
      font-size: 12px;
      border: 1px solid rgba(255, 255, 255, 0.3);
    }
    .book-mode-controls .page-counter { background: #f8f9fa; padding: 8px 12px; font-size: 14px; border: 1px solid #ddd; }

    /* Container do visualizador */
    .journal-container {
      width: 100%;
      max-width: 800px;
      margin: 0 auto;
      position: relative;
      transition: all 0.5s ease;
    }

    /* --- MODO NATIVO --- */
    .native-mode { display: block; padding-bottom: 50px; }
    .native-mode .page-image {
      width: 100%;
      height: auto;
      display: block;
      margin-bottom: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    /* --- MODO REVISTA (Efeito Realista) --- */
    .book-mode {
      display: none;
      position: relative;
      height: 85vh;
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      perspective: 2000px; /* Perspectiva alta para suavizar o 3D */
    }

    .book-spread {
      position: relative;
      width: 90vw;
      max-width: 1100px;
      aspect-ratio: 1.5 / 1;
      transform-style: preserve-3d;
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.4); /* Sombra flutuante */
    }

    .book-page {
      position: absolute;
      width: 50%;
      height: 100%;
      top: 0;
      background-color: #fdfdfd; /* Cor de papel levemente off-white */
      overflow: hidden;
      transform-style: preserve-3d;
      backface-visibility: hidden;
      /* Timing function ease-in-out para simular inércia do papel */
      transition: transform 0.9s cubic-bezier(0.4, 0, 0.2, 1), 
                  box-shadow 0.9s cubic-bezier(0.4, 0, 0.2, 1),
                  border-radius 0.5s ease; 
      
      /* Gradiente sutil para textura de papel */
      background-image: linear-gradient(to right, rgba(0,0,0,0.02), rgba(0,0,0,0));
    }

    .book-page img {
      width: 100%;
      height: 100%;
      object-fit: fill;
      user-select: none;
      pointer-events: none; /* Evita arrastar a imagem fantasma */
    }

    /* Configuração Página Esquerda */
    .book-page.left-page {
      left: 0;
      transform-origin: right center;
      border-radius: 4px 0 0 4px;
      z-index: 1;
    }
    /* Sombra na lombada esquerda */
    .book-page.left-page::after {
      content: ""; position: absolute; top:0; right:0; bottom:0; width: 40px;
      background: linear-gradient(to left, rgba(0,0,0,0.15), transparent);
      pointer-events: none; z-index: 5;
    }

    /* Configuração Página Direita */
    .book-page.right-page {
      right: 0;
      transform-origin: left center;
      border-radius: 0 4px 4px 0;
      z-index: 1;
    }
    /* Sombra na lombada direita */
    .book-page.right-page::after {
      content: ""; position: absolute; top:0; left:0; bottom:0; width: 40px;
      background: linear-gradient(to right, rgba(0,0,0,0.15), transparent);
      pointer-events: none; z-index: 5;
    }

    /* --- ANIMAÇÕES DE VIRADA COM EFEITO CURVADO --- */
    
    /* Virando da Direita para Esquerda (Next) */
    .turn-to-left {
      transform: rotateY(-180deg);
      z-index: 20;
    }
    
    /* Virando da Esquerda para Direita (Prev) */
    .turn-to-right {
      transform: rotateY(180deg);
      z-index: 20;
    }

    /* Classe auxiliar para aplicar o efeito de "dobra" (border-radius) durante o movimento */
    .bending-page {
      /* Simula a folha dobrando no canto inferior durante a passagem */
      border-bottom-right-radius: 100px !important;
      border-top-right-radius: 20px !important; 
      box-shadow: 10px 10px 30px rgba(0,0,0,0.2);
    }
    
    /* Para a página esquerda voltando */
    .bending-page-left {
      border-bottom-left-radius: 100px !important;
      border-top-left-radius: 20px !important;
      box-shadow: -10px 10px 30px rgba(0,0,0,0.2);
    }

    /* Estados auxiliares */
    .start-turned-left { transform: rotateY(-180deg); }
    .start-turned-right { transform: rotateY(180deg); }
    .notransition { transition: none !important; }

    /* Zoom / Pan */
    .zoomed { cursor: grab; transform-origin: top left; position: absolute; pointer-events: auto !important; }
    .zoomed:active { cursor: grabbing; }

    /* Mobile */
    @media (max-width: 768px) {
      .viewer-controls { display: none; }
      .journal-container { max-width: 100%; padding: 0 10px; }
      .book-mode { display: none !important; }
      .native-mode { display: block !important; }
    }
    
    /* Background realista */
    .book-mode::before {
      content: ''; position: absolute; inset: 0;
      background: radial-gradient(circle, #ddd 0%, #bbb 100%);
      z-index: -1;
    }
  </style>
</head>
<body>
  <div id="menu-placeholder"></div>

  <main>
    <div class="viewer-controls" id="viewerControls">
      <button class="control-btn" id="prevBtn" onclick="previousPage()" title="Anterior"><i class="fas fa-chevron-left"></i></button>
      <div class="page-counter"><span id="currentPageNum">1</span>/<span id="totalPages">17</span></div>
      <button class="control-btn" id="nextBtn" onclick="nextPage()" title="Próximo"><i class="fas fa-chevron-right"></i></button>
      
      <div class="zoom-controls">
        <button class="control-btn" onclick="zoomOut()"><i class="fas fa-search-minus"></i></button>
        <button class="control-btn" onclick="zoomIn()"><i class="fas fa-search-plus"></i></button>
        <button class="control-btn" onclick="resetZoom()"><i class="fas fa-expand"></i></button>
      </div>
      <button class="control-btn mode-toggle" id="modeToggle" onclick="toggleMode()">Revista</button>
    </div>

    <div class="journal-container" id="journalContainer">
      <!-- MODO NATIVO -->
      <div class="native-mode" id="nativeMode"></div>

      <!-- MODO REVISTA -->
      <div class="book-mode" id="bookMode">
        <div class="book-spread" id="bookSpread">
          <div class="book-page left-page" id="leftPage">
            <img src="" alt="Página Esquerda">
          </div>
          <div class="book-page right-page" id="rightPage">
            <img src="" alt="Página Direita">
          </div>
        </div>
      </div>
    </div>
  </main>

  <div id="footer-placeholder"></div>

  <script>
    const pages = [
      'https://i.postimg.cc/y602YBCK/0-CAPA.jpg',
      'https://i.postimg.cc/pVK3XxMX/01-Sumario.jpg',
      'https://i.postimg.cc/NGRZfYv9/02-Missao-e-Valores.jpg',
      'https://i.postimg.cc/Fsm8YqhK/03-Tema-do-Mes.jpg',
      'https://i.postimg.cc/KctCvFhT/04-Tema-do-Mes.jpg',
      'https://i.postimg.cc/8PD973Tf/05-Vale-a-Leitura.jpg',
      'https://i.postimg.cc/dtvphXJT/06-Series-e-Filmes.jpg',
      'https://i.postimg.cc/15P28Ty6/07-Reflexao.jpg',
      'https://i.postimg.cc/Qxsw-FPj1/08-Reflexao.jpg',
      'https://i.postimg.cc/TYGFKSTJ/09-Reflexao.jpg',
      'https://i.postimg.cc/KvFw1Vmr/10-Bem-Estar.jpg',
      'https://i.postimg.cc/GhrV4NbX/11-Meio-Ambiente.jpg',
      'https://i.postimg.cc/vHMk4jGP/12-Curiosidades.jpg',
      'https://i.postimg.cc/RVR8KR0P/13-Curiosidades.jpg',
      'https://i.postimg.cc/28wJhw59/14-Aniversariantes.jpg',
      'https://i.postimg.cc/L6T7LTsw-/15-Desligamento.jpg',
      'https://i.postimg.cc/X78hd8J6/16-Novos-Clientes.jpg'
    ];

    let currentPage = 0;
    const totalPages = pages.length;
    let isBookMode = false;
    let zoomLevel = 1;
    let isDragging = false;
    let startX, startY, imgX = 0, imgY = 0;
    let isAnimating = false;
    let dragElement = null;

    document.addEventListener('DOMContentLoaded', () => {
      const loadExternal = (id, file) => {
        const el = document.getElementById(id);
        if(el) fetch(`${file}.html`).then(r => r.text()).then(h => el.innerHTML = h).catch(e=>{});
      };
      loadExternal('menu-placeholder', 'menu.html');
      loadExternal('footer-placeholder', 'footer.html');

      const nativeContainer = document.getElementById('nativeMode');
      pages.forEach((src, i) => {
        const img = document.createElement('img');
        img.src = src; img.className = 'page-image'; img.loading = 'lazy';
        nativeContainer.appendChild(img);
      });

      updatePageCounter();
      document.getElementById('totalPages').textContent = totalPages;
      updateBookImages(0);
    });

    function nextPage() {
      if (isAnimating) return;
      if (isBookMode) {
        if (currentPage < totalPages - 1) animateBookTurn('next');
      } else {
        if (currentPage < totalPages - 1) { currentPage++; scrollToCurrentPage(); updatePageCounter(); }
      }
    }

    function previousPage() {
      if (isAnimating) return;
      if (isBookMode) {
        if (currentPage >= 2) animateBookTurn('prev');
      } else {
        if (currentPage > 0) { currentPage--; scrollToCurrentPage(); updatePageCounter(); }
      }
    }

    // --- LÓGICA DE ANIMAÇÃO REALISTA ---
    function animateBookTurn(direction) {
      isAnimating = true;
      const leftPage = document.getElementById('leftPage');
      const rightPage = document.getElementById('rightPage');
      const duration = 900; // Tempo da transição CSS

      if (direction === 'next') {
        // 1. Inicia rotação
        rightPage.classList.add('turn-to-left');
        
        // 2. Aplica efeito de dobra (curva) no início da virada
        setTimeout(() => { rightPage.classList.add('bending-page'); }, 50);

        // 3. Na metade (90 graus), troca conteúdo e remove a dobra
        setTimeout(() => {
          currentPage += 2;
          updateBookImages(currentPage);
          updatePageCounter();
          
          // Troca instantânea de posições lógicas para visuais
          rightPage.classList.remove('bending-page'); // Remove dobra
          rightPage.classList.add('notransition');
          rightPage.classList.remove('turn-to-left');
          
          leftPage.classList.add('notransition');
          leftPage.classList.add('start-turned-right'); // Esquerda começa onde a direita parou
          
          // Força renderização
          void leftPage.offsetWidth; 
          
          // Completa o movimento
          leftPage.classList.remove('notransition');
          leftPage.classList.remove('start-turned-right');
          rightPage.classList.remove('notransition');
        }, duration / 2); // 450ms

        setTimeout(() => { isAnimating = false; }, duration + 50);

      } else {
        // Lógica Inversa (Prev)
        leftPage.classList.add('turn-to-right');
        setTimeout(() => { leftPage.classList.add('bending-page-left'); }, 50);

        setTimeout(() => {
          currentPage -= 2;
          updateBookImages(currentPage);
          updatePageCounter();

          leftPage.classList.remove('bending-page-left');
          leftPage.classList.add('notransition');
          leftPage.classList.remove('turn-to-right');

          rightPage.classList.add('notransition');
          rightPage.classList.add('start-turned-left');
          void rightPage.offsetWidth;

          rightPage.classList.remove('notransition');
          rightPage.classList.remove('start-turned-left');
          leftPage.classList.remove('notransition');
        }, duration / 2);

        setTimeout(() => { isAnimating = false; }, duration + 50);
      }
    }

    function updateBookImages(pageIndex) {
      const leftImg = document.querySelector('#leftPage img');
      const rightImg = document.querySelector('#rightPage img');

      if (pageIndex % 2 !== 0) pageIndex--; // Garante par

      leftImg.src = pages[pageIndex] || '';
      // GIF transparente se não tiver página
      rightImg.src = pages[pageIndex + 1] || 'data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=';
      
      resetZoom();
    }

    function toggleMode() {
      isBookMode = !isBookMode;
      const native = document.getElementById('nativeMode');
      const book = document.getElementById('bookMode');
      const container = document.getElementById('journalContainer');
      const controls = document.getElementById('viewerControls');
      const toggleBtn = document.getElementById('modeToggle');

      resetZoom();

      if (isBookMode) {
        native.style.display = 'none';
        book.style.display = 'flex';
        container.style.maxWidth = '100%';
        toggleBtn.textContent = 'Nativo';
        controls.classList.add('book-mode-controls');
        if (currentPage % 2 !== 0) currentPage--;
        updateBookImages(currentPage);
      } else {
        native.style.display = 'block';
        book.style.display = 'none';
        container.style.maxWidth = '800px';
        toggleBtn.textContent = 'Revista';
        controls.classList.remove('book-mode-controls');
        scrollToCurrentPage();
      }
      updatePageCounter();
    }

    function scrollToCurrentPage() {
      const imgs = document.querySelectorAll('#nativeMode .page-image');
      if (imgs[currentPage]) imgs[currentPage].scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    function updatePageCounter() {
      document.getElementById('currentPageNum').textContent = currentPage + 1;
      const prev = document.getElementById('prevBtn');
      const next = document.getElementById('nextBtn');
      if (isBookMode) {
        prev.disabled = currentPage < 2;
        next.disabled = currentPage >= (totalPages % 2 === 0 ? totalPages - 2 : totalPages - 1);
      } else {
        prev.disabled = currentPage === 0;
        next.disabled = currentPage === totalPages - 1;
      }
    }

    // Zoom
    function zoomIn() { if(zoomLevel < 3) { zoomLevel += 0.5; applyZoom(); } }
    function zoomOut() { if(zoomLevel > 1) { zoomLevel -= 0.5; applyZoom(); } }
    function resetZoom() { zoomLevel = 1; imgX = 0; imgY = 0; applyZoom(); }
    
    function applyZoom() {
      const targets = isBookMode ? document.querySelectorAll('.book-page img') : document.querySelectorAll('.native-mode .page-image');
      targets.forEach(img => {
        if (zoomLevel > 1) {
          img.style.transform = `scale(${zoomLevel}) translate(${imgX}px, ${imgY}px)`;
          img.classList.add('zoomed');
          img.onmousedown = startDrag;
        } else {
          img.style.transform = 'none';
          img.classList.remove('zoomed');
          img.onmousedown = null;
          imgX = 0; imgY = 0;
        }
      });
    }

    function startDrag(e) {
      if (zoomLevel <= 1) return;
      e.preventDefault();
      isDragging = true;
      dragElement = e.target;
      startX = e.clientX;
      startY = e.clientY;
      document.addEventListener('mousemove', drag);
      document.addEventListener('mouseup', endDrag);
    }
    function drag(e) {
      if (!isDragging || !dragElement) return;
      e.preventDefault();
      imgX += (e.clientX - startX) / zoomLevel;
      imgY += (e.clientY - startY) / zoomLevel;
      dragElement.style.transform = `scale(${zoomLevel}) translate(${imgX}px, ${imgY}px)`;
      startX = e.clientX;
      startY = e.clientY;
    }
    function endDrag() {
      isDragging = false;
      document.removeEventListener('mousemove', drag);
      document.removeEventListener('mouseup', endDrag);
    }

    document.addEventListener('keydown', (e) => {
      if (window.innerWidth > 768) {
        if (e.key === 'ArrowRight') nextPage();
        if (e.key === 'ArrowLeft') previousPage();
        if (e.key === 'Escape') resetZoom();
      }
    });
  </script>
</body>
</html>
