<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="color-scheme" content="light">
  <meta name="supported-color-schemes" content="light">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma"        content="no-cache" />
  <meta http-equiv="Expires"       content="0" />
  <meta name="robots" content="noindex, nofollow">
  <link rel="icon" href="favicon.png" type="image/png">
  <meta property="og:title" content="Portal PSR">
  <meta property="og:description" content="Acesse nosso canal interno com not√≠cias, card√°pio, aniversariantes e muito mais!">
  <meta property="og:image" content="https://psrimpressao.com.br/wp-content/uploads/2026/01/thumbnail.jpg">
  <meta property="og:image:type" content="image/jpeg">
  <meta property="og:url" content="https://psrindustria.github.io/PortalPSR/">
  <meta property="og:type" content="website">
  <link rel="preconnect" href="https://jornalpsr-1b8c6-default-rtdb.firebaseio.com">
  <link rel="dns-prefetch" href="https://jornalpsr-1b8c6-default-rtdb.firebaseio.com">
  <meta name="color-scheme" content="light only">
  <title>PortalPSR</title>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css?v=2" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

<style>
    /* ==================================================
       CONFIGURA√á√ïES GERAIS E VARI√ÅVEIS
       ================================================== */
    :root {
        --azul-marinho: #003366;
        --azul-aco: #4682B4;
        --dourado: #DAA520;
        --verde-escuro: #006400;
        --verde-sucesso: #28a745;
        --vermelho-erro: #dc3545;
        --cinza-escuro: #4B4B4B;
        --cinza-texto: #666666;
        --branco: #FFFFFF;
        --cinza-claro-bg: #f4f7f9;
        --sombra-card-jornal: 0 4px 12px rgba(0, 0, 0, 0.08);
        --sombra-suave: 0 10px 30px -10px rgba(0, 51, 102, 0.15);
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    /* MENU FIXO ANTI-QUEBRA */
    #menu-placeholder { position: fixed; top: 0; left: 0; width: 100%; z-index: 1001; }
    #menu-placeholder header { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif !important; }
    #menu-placeholder nav ul li a { white-space: nowrap !important; }
    @media (min-width: 769px) and (max-width: 1100px) {
      #menu-placeholder nav ul li { margin-left: 10px !important; }
      #menu-placeholder nav ul li a { font-size: 0.9rem; padding: 8px 5px !important; }
    }

    body {
        font-family: 'Poppins', sans-serif;
        background-color: var(--cinza-claro-bg);
        color: var(--cinza-escuro);
        line-height: 1.6;
        padding-top: 90px;
        margin: 0;
        padding-bottom: 20px;
    }

    #footer-placeholder { margin-top: 0px; }

    /* ESTILOS DO JORNAL */
    .jornal-main { max-width: 1200px; margin: 0 auto; padding: 20px; }
    .jornal-section-title { font-size: 2em; font-weight: 700; color: var(--azul-marinho); margin-bottom: 20px; margin-top: 0; text-align: center; }
    
    section { position: relative; margin-bottom: 80px; padding-bottom: 50px; }
    section::after {
        content: ""; position: absolute; bottom: 0; left: 15%; width: 70%; height: 1px;
        background: linear-gradient(90deg, transparent, var(--azul-marinho), var(--dourado), var(--azul-marinho), transparent);
        opacity: 0.15; border-radius: 50%;
    }
    main > section:last-of-type::after { display: none; }

    .section-description { text-align: center; font-size: 0.95em; color: #666; max-width: 800px; margin: 0 auto 40px; font-style: italic; }

    /* DESTAQUES */
    .destaque-container { border-radius: 15px; padding: 60px 40px; margin-bottom: 40px; text-align: center; box-shadow: var(--sombra-card-jornal); color: var(--azul-marinho); border: 1px solid rgba(0,0,0,0.05); transition: all 0.5s ease; position: relative; overflow: hidden; }
    .tema-mes-bg { background: linear-gradient(rgba(255, 255, 255, 0.75), rgba(255, 255, 255, 0.98)), url('https://i.postimg.cc/pWWZhcwT/wallpaper-janery-branco.jpg?q=80&w=2070&auto=format&fit=crop'); background-size: cover; background-position: center; }
    .destaque-container h2 { font-size: 2.2em; margin-bottom: 10px; font-weight: 700; color: var(--azul-marinho); }
    .destaque-container p { font-size: 1.1em; margin-bottom: 20px; color: #444; }
    .destaque-icon { font-size: 3.5em; margin-bottom: 15px; text-shadow: 0 2px 10px rgba(0,0,0,0.1); }

    /* BOT√ïES & EXPANS√ÉO */
    .materia-completa { display: none; text-align: left; max-width: 800px; margin: 20px auto 0; border-top: 1px solid rgba(0,35,102, 0.1); padding-top: 20px; animation: fadeIn 0.6s ease-in-out; }
    .fonte-materia { font-size: 0.85em; color: #777; margin-top: 20px; border-top: 1px solid #eee; padding-top: 10px; text-align: center; }
    .fonte-materia a { color: var(--azul-aco); text-decoration: none; font-weight: 600; }
    .fonte-materia a:hover { text-decoration: underline; }
    .btn-ler-mais { background-color: var(--azul-marinho); color: var(--branco); padding: 12px 35px; border: none; border-radius: 50px; font-weight: 600; cursor: pointer; font-size: 1rem; margin-top: 15px; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(0, 51, 102, 0.2); }
    .btn-ler-mais:hover { background-color: var(--dourado); color: var(--azul-marinho); transform: translateY(-2px); }

    /* CARDS GERAIS */
    .cards-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px; }
    .jornal-card { background-color: #fff; border-radius: 15px; box-shadow: var(--sombra-card-jornal); overflow: hidden; transition: transform 0.3s, box-shadow 0.3s; display: flex; flex-direction: column; border: 1px solid #eee; }
    .jornal-card:hover { transform: translateY(-8px); box-shadow: 0 12px 25px rgba(0, 0, 0, 0.15); }
    .jornal-card-content { padding: 25px; flex-grow: 1; display: flex; flex-direction: column; }
    .jornal-card-content h3 { font-size: 1.4em; color: var(--azul-marinho); margin-bottom: 10px; font-weight: 600; }
    .jornal-card-content p { color: #555; margin-bottom: 15px; line-height: 1.6; }

    /* ==================================================
       ESTILOS NOVOS CLIENTES (HEADER & LISTA)
       ================================================== */
    .clientes-header { background: var(--branco); border-radius: 12px; box-shadow: var(--sombra-suave); padding: 35px 20px 20px 20px; margin-bottom: 30px; position: relative; overflow: hidden; border-top: 4px solid var(--dourado); text-align: center; }
    .stats-row { display: flex; justify-content: center; align-items: center; gap: 20px; margin-bottom: 25px; }
    .stat-box { display: flex; align-items: center; justify-content: center; }
    .stat-box-inner { display: flex; flex-direction: row; align-items: center; gap: 15px; }
    .stat-num { font-size: 3.5em; font-weight: 600; color: var(--azul-marinho); line-height: 1; letter-spacing: -1px; }
    .stat-label { font-size: 1.5em; color: var(--azul-marinho); font-weight: 600; text-transform: none; }
    .data-discreta { color: #999; font-size: 0.9em; margin-top: 5px; display: inline-flex; align-items: center; gap: 5px; }

    /* LISTA DE CLIENTES */
    .clientes-compact-list { background: white; border-radius: 15px; box-shadow: var(--sombra-suave); overflow: hidden; border: 1px solid #eee; display: none; animation: fadeIn 0.5s ease; padding: 10px; }
    #lista-clientes-content { display: grid; grid-template-columns: repeat(3, 1fr); gap: 0; }
    .cliente-item { display: flex; align-items: center; gap: 10px; padding: 15px 20px; border-bottom: 1px solid #f0f0f0; border-right: 1px solid #f0f0f0; transition: all 0.3s ease; background: #fff; }
    .cliente-item:hover { background: #f8f9fa; }
    .cliente-item.destaque { background: linear-gradient(90deg, rgba(218, 165, 32, 0.05), rgba(255, 255, 255, 0)); border-left: 3px solid var(--dourado); }
    .cliente-icon-mini { font-size: 1.2em; min-width: 30px; text-align: center; }
    .cliente-info { flex: 1; display: flex; align-items: center; gap: 10px; flex-wrap: wrap; }
    .cliente-info span { color: var(--cinza-escuro); font-size: 0.9em; font-weight: 500; }
    .badge-destaque { background: var(--dourado); color: white; padding: 2px 8px; border-radius: 10px; font-size: 0.7em !important; font-weight: 700 !important; }
    .btn-ver-todos { background: white; border: 1px solid var(--azul-marinho); color: var(--azul-marinho); padding: 12px 35px; border-radius: 30px; font-size: 0.9em; font-weight: 500; cursor: pointer; transition: all 0.3s ease; display: inline-flex; align-items: center; gap: 8px; margin-top: 10px; letter-spacing: 0.5px; }
    .btn-ver-todos:hover { background: var(--azul-marinho); color: white; transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,51,102,0.2); }
    .loading-container { text-align: center; padding: 20px; color: #999; grid-column: 1 / -1; }

    @media (max-width: 768px) {
        .stat-box-inner { flex-direction: column; gap: 5px; }
        .stat-label { font-size: 0.75em; text-transform: uppercase; letter-spacing: 2px; color: var(--cinza-texto); }
        #lista-clientes-content { grid-template-columns: 1fr; }
        .cliente-item { border-right: none; }
    }

    /* RECEITAS */
    .receita-card { background-color: var(--branco); border-radius: 15px; overflow: hidden; box-shadow: var(--sombra-card-jornal); transition: transform 0.3s; border: 1px solid #eee; display: flex; flex-direction: column; text-align: center; }
    .receita-card:hover { transform: translateY(-5px); }
    .receita-imagem { width: 100%; height: 180px; background: linear-gradient(135deg, rgba(0, 100, 0, 0.85), rgba(34, 139, 34, 0.85)), url('https://images.unsplash.com/photo-1512621776951-a57141f2eefd?q=80&w=2070&auto=format&fit=crop'); background-size: cover; background-position: center; display: flex; align-items: center; justify-content: center; font-size: 3.5em; color: white; text-shadow: 0 2px 10px rgba(0,0,0,0.2); }
    .receita-info { padding: 25px; flex-grow: 1; display: flex; flex-direction: column; align-items: center; }
    .receita-info h4 { font-size: 1.3em; color: var(--azul-marinho); margin-bottom: 5px; font-weight: 700; }
    .receita-tempo { font-size: 0.9em; color: var(--dourado); font-weight: 600; margin-bottom: 5px; }
    .receita-info p { font-size: 0.95em; color: #555; line-height: 1.6; margin-bottom: 15px; }
    .receita-detalhes { display: none; margin-top: 15px; padding-top: 15px; border-top: 1px solid #eee; animation: fadeIn 0.4s ease; text-align: left; width: 100%; }
    .receita-detalhes h5 { color: var(--azul-marinho); margin: 10px 0 5px; font-size: 1em; }
    .receita-detalhes ul, .receita-detalhes ol { margin-left: 20px; font-size: 0.9em; color: #555; text-align: left; }
    .btn-ver-receita { background-color: var(--verde-escuro); color: white; border: none; padding: 10px 20px; border-radius: 25px; cursor: pointer; font-weight: 600; margin-top: auto; transition: 0.3s; width: 100%; }
    .btn-ver-receita:hover { background-color: var(--dourado); color: var(--azul-marinho); }

    /* DESAFIOS */
    .desafio-saude-card { background-color: var(--branco); border-radius: 15px; padding: 25px; box-shadow: var(--sombra-card-jornal); border: 1px solid #eee; border-top: 5px solid var(--verde-escuro); transition: transform 0.3s; display: flex; flex-direction: column; }
    .desafio-saude-card:hover { transform: translateX(5px); }
    .desafio-saude-card h4 { font-size: 1.2em; color: var(--azul-marinho); margin-bottom: 10px; display: flex; align-items: center; gap: 10px; font-weight: 600; }
    .challenge-buttons { display: flex; gap: 10px; margin-bottom: 10px; }
    .btn-challenge { flex: 1; padding: 8px; border: 1px solid #ddd; border-radius: 8px; background: #fff; cursor: pointer; font-size: 0.9em; font-weight: 600; transition: all 0.2s; color: #777; }
    .btn-challenge.success:hover, .btn-challenge.success.active { background-color: var(--verde-sucesso); color: white; border-color: var(--verde-sucesso); }
    .btn-challenge.fail:hover, .btn-challenge.fail.active { background-color: var(--vermelho-erro); color: white; border-color: var(--vermelho-erro); }
    .challenge-stats { font-size: 0.8em; color: #777; display: flex; justify-content: space-between; padding: 0 5px; }
    .stat-success { color: var(--verde-sucesso); font-weight: 700; }
    .stat-fail { color: var(--vermelho-erro); font-weight: 700; }

    /* DEPOIMENTOS */
    .testimonials-section { margin-top: 20px; background: #fff; padding: 40px; border-radius: 15px; box-shadow: var(--sombra-card-jornal); text-align: center; border: 1px solid #eee; }
    .testimonials-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-top: 30px; text-align: left; }
    .testimonial-card { background: var(--cinza-claro-bg); padding: 20px; border-radius: 10px; border-top: 4px solid var(--dourado); box-shadow: 0 2px 5px rgba(0,0,0,0.05); display: flex; flex-direction: column; }
    .testimonial-author { font-weight: 700; color: var(--azul-marinho); margin-bottom: 5px; display: block; font-size: 0.95em; }
    .testimonial-text { font-style: italic; color: #555; font-size: 0.9em; line-height: 1.6; margin-bottom: 10px; flex-grow: 1; }
    .testimonial-date { font-size: 0.75em; color: #999; display: block; margin-top: 5px; text-align: right; }

    /* HOBBY */
    .hobby-container { background-color: var(--branco); border-radius: 15px; box-shadow: var(--sombra-card-jornal); overflow: hidden; margin-bottom: 40px; border: 1px solid #eee; }
    .hobby-content { display: grid; grid-template-columns: 40% 60%; min-height: 350px; }
    .hobby-foto { position: relative; height: 100%; background-color: var(--cinza-claro-bg); }
    .hobby-foto img { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; object-position: center top; }
    .hobby-texto { padding: 40px; display: flex; flex-direction: column; justify-content: center; text-align: left; }
    .hobby-titulo { font-size: 1.1em; color: var(--dourado); font-weight: 700; margin-bottom: 25px; text-transform: uppercase; }
    
    /* CORRE√á√ÉO DO √çCONE DE ASPAS */
/* ESTILO DA CAIXA DE CITA√á√ÉO (Estilo Revista) */
    .hobby-quote-box { 
        background: #f8f9fa; 
        border-left: 4px solid var(--azul-marinho); 
        padding: 20px 25px; 
        margin-bottom: 25px; 
        border-radius: 0 10px 10px 0; 
        display: block; /* Removemos o flex para permitir o texto fluir */
    }

    .hobby-quote-box i { 
        color: var(--dourado); 
        font-size: 1.5em; 
        float: left;        /* O segredo: faz o √≠cone flutuar √† esquerda */
        margin-right: 8px; /* Espa√ßo entre as aspas e a primeira letra */
        line-height: 1;
    }

    .hobby-quote-box p {
        font-style: italic;
        margin: 0;
        color: #555;
        line-height: 1.6;
        display: inline; /* Garante que o texto se comporte fluidamente */
    }
    
    .hobby-tag { display: inline-block; background-color: var(--verde-escuro); color: var(--branco); padding: 8px 16px; border-radius: 50px; font-size: 0.85em; font-weight: 600; margin-right: 8px; margin-bottom: 8px; }
    .hobby-actions { display: flex; gap: 15px; margin-top: 20px; padding-top: 15px; border-top: 1px solid #eee; }
    .hobby-btn-action { background: none; border: none; cursor: pointer; display: flex; align-items: center; gap: 8px; font-size: 0.95em; color: #777; font-weight: 600; transition: all 0.2s; padding: 5px 10px; border-radius: 20px; }
    .hobby-btn-action:hover { background-color: #f0f7ff; color: var(--azul-marinho); }
    .hobby-btn-action.liked { color: #e91e63; }
    .hobby-comments-section { display: none; margin-top: 15px; background: #f9f9f9; padding: 15px; border-radius: 10px; border: 1px solid #eee; animation: fadeIn 0.3s ease; }
    .hobby-comment-item { background: white; padding: 10px; border-radius: 8px; margin-bottom: 8px; border: 1px solid #eee; font-size: 0.9em; color: #555; }
    .hobby-comment-item strong { color: var(--azul-marinho); display: block; margin-bottom: 2px; }

    /* ELOGIOS */
    .praise-header { text-align: center; margin-bottom: 30px; }
    .praise-archive-links { display: flex; justify-content: center; gap: 8px; flex-wrap: wrap; margin-top: 15px; }
    .praise-link { color: #888; cursor: pointer; text-decoration: none; padding: 4px 12px; border-radius: 20px; transition: all 0.2s; font-size: 0.85em; border: 1px solid #eee; background: #fff; }
    .praise-link:hover { color: var(--azul-marinho); border-color: var(--azul-marinho); }
    .praise-link.active { color: var(--branco); background: var(--azul-marinho); font-weight: 600; border-color: var(--azul-marinho); }
    .praise-card { background: #fff; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); padding: 20px; border-top: 4px solid var(--verde-sucesso); display: flex; flex-direction: column; }
    .praise-from-to { font-size: 0.9em; color: #777; margin-bottom: 10px; border-bottom: 1px solid #eee; padding-bottom: 8px; }
    .praise-like-btn { cursor: pointer; color: #ccc; transition: color 0.2s; font-size: 1.1em; display: flex; align-items: center; gap: 5px; border: none; background: none; }
    .praise-like-btn.liked { color: #e91e63; }

    /* JOGOS */
    .hiscore-menu { display: flex; justify-content: center; gap: 10px; margin-bottom: 30px; flex-wrap: wrap; }
    .hiscore-btn { background: #fff; border: 1px solid var(--dourado); color: var(--azul-marinho); padding: 8px 20px; border-radius: 20px; cursor: pointer; font-weight: 600; font-size: 0.9em; transition: all 0.3s; display: flex; align-items: center; gap: 8px; }
    .hiscore-btn:hover { background: var(--dourado); color: white; transform: translateY(-2px); }
    .game-card { background: #fff; border-radius: 15px; box-shadow: var(--sombra-card-jornal); overflow: hidden; transition: transform 0.3s, box-shadow 0.3s; display: flex; flex-direction: column; border: 1px solid #eee; text-decoration: none; color: inherit; height: 100%; }
    .game-card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.15); }
    .game-banner { width: 100%; height: 160px; object-fit: cover; background: #eee; }
    .game-info { padding: 15px; text-align: center; background: #fff; }

    /* FORMUL√ÅRIOS & BOT√ïES GERAIS */
    .suggestion-section { max-width: 600px; margin: 40px auto 0; text-align: center; }
    .btn-suggestion { background-color: var(--azul-marinho); color: var(--branco); font-weight: 600; padding: 12px 35px; border: none; border-radius: 50px; font-size: 1rem; cursor: pointer; box-shadow: 0 4px 15px rgba(0, 51, 102, 0.2); transition: all 0.3s ease; display: inline-flex; align-items: center; gap: 10px; }
    .btn-suggestion:hover { background-color: var(--dourado); color: var(--azul-marinho); transform: translateY(-2px); }
    .suggestion-card-form { display: none; background: #fff; margin-top: 20px; padding: 30px; border-radius: 15px; box-shadow: var(--sombra-card-jornal); border: 1px solid #eee; text-align: left; animation: fadeIn 0.5s ease-in-out; }
    .form-group { margin-bottom: 20px; }
    .form-group label { display: block; font-weight: 600; color: var(--azul-marinho); margin-bottom: 5px; }
    .form-group input, .form-group textarea { width: 100%; padding: 12px; border: 2px solid #eee; border-radius: 8px; font-family: inherit; font-size: 1rem; }
    .btn-submit-suggestion { width: 100%; background-color: var(--azul-marinho); color: white; padding: 12px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; font-size: 1rem; transition: 0.3s; }
    .btn-submit-suggestion:hover { background-color: var(--dourado); color: var(--azul-marinho); }

    /* CULTURA */
    .video-thumbnail-container { position: relative; width: 100%; padding-bottom: 56.25%; background-color: #000; overflow: hidden; cursor: pointer; }
    .video-thumbnail-container img { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; opacity: 0.9; transition: opacity 0.3s; }
    .video-thumbnail-container:hover img { opacity: 0.7; }
    .play-button { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 4rem; color: rgba(255, 255, 255, 0.9); pointer-events: none; transition: transform 0.3s; }
    .video-thumbnail-container:hover .play-button { transform: translate(-50%, -50%) scale(1.1); color: #ff0000; }
    
    /* CORRE√á√ÉO BOT√ÉO SINOPSE */
    .btn-ler-sinopse { 
        background-color: transparent; 
        border: 2px solid var(--azul-marinho); 
        color: var(--azul-marinho); 
        padding: 6px 20px; 
        border-radius: 20px; 
        font-weight: 600; 
        cursor: pointer; 
        margin-top: auto; 
        margin-bottom: 8px; 
        transition: all 0.3s; 
        font-size: 0.9em;
        align-self: center; /* Centraliza no flex container */
        width: auto; /* Evita que estique */
        min-width: 120px;
    }
    .btn-ler-sinopse:hover { background-color: var(--azul-marinho); color: white; }
    
    .tag-discreta { font-size: 0.75em; color: #999; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 15px; }
    .indicacao-texto { font-size: 0.85em; color: var(--azul-aco); margin-bottom: 10px !important; font-style: italic; }
    .rating-container { margin-top: auto; padding-top: 15px; border-top: 1px solid #eee; text-align: center; }
    .rating-stars { display: inline-flex; gap: 5px; font-size: 1.5rem; cursor: pointer; color: #d1d1d1; }
    .rating-stars i.filled { color: var(--dourado) !important; }
    .rating-stars i:hover, .rating-stars i:hover ~ i { color: var(--dourado) !important; }
    .score-value { font-weight: 700; font-size: 1.2em; color: var(--azul-marinho); }

    /* QUIZ & ABAS */
    .tab-btn { transition: all 0.3s; }
    .tab-btn:hover { color: var(--dourado) !important; }
    .tab-btn.active { color: var(--azul-marinho) !important; border-bottom: 3px solid var(--dourado) !important; }
    .quiz-container { background: #fff; padding: 20px; border-radius: 15px; box-shadow: var(--sombra-card-jornal); margin-top: 40px; border-top: 5px solid var(--azul-marinho); }
    .btn-toggle-quiz { width: 100%; background-color: var(--azul-marinho); color: var(--branco); border: none; padding: 15px; border-radius: 50px; font-size: 1.1em; font-weight: 600; cursor: pointer; transition: all 0.3s ease; margin-bottom: 20px; display: flex; align-items: center; justify-content: center; gap: 10px; box-shadow: 0 4px 15px rgba(0, 51, 102, 0.2); }
    .btn-toggle-quiz:hover { background-color: var(--dourado); color: var(--azul-marinho); transform: translateY(-2px); }
    #quiz-content { display: none; animation: fadeIn 0.5s ease; }
    .quiz-question { margin-bottom: 30px; border-bottom: 1px solid #eee; padding-bottom: 20px; }
    .quiz-option { display: flex; align-items: center; gap: 10px; cursor: pointer; padding: 10px; border-radius: 8px; transition: background 0.2s; border: 1px solid transparent; }
    .quiz-option:hover { background: #f0f7ff; }
    .quiz-stats { margin-top: 10px; font-size: 0.85em; color: #666; background: #eee; border-radius: 5px; overflow: hidden; height: 20px; position: relative; display: none; }
    .quiz-bar { background: var(--verde-sucesso); height: 100%; width: 0%; transition: width 1s ease; }
    .quiz-bar-text { position: absolute; top: 0; left: 5px; line-height: 20px; color: #333; font-weight: 600; font-size: 0.8em; z-index: 2; }
    .correct-answer { background-color: rgba(40, 167, 69, 0.2) !important; border: 1px solid var(--verde-sucesso); }
    
    /* BANNERS */
    .banner-metade { width: 100%; height: 180px; display: flex; align-items: center; justify-content: center; font-size: 3.5em; color: white; text-shadow: 0 2px 10px rgba(0,0,0,0.5); background-size: cover; background-position: center; }
    .banner-saude-fisica { background: linear-gradient(135deg, rgba(34, 139, 34, 0.80), rgba(0, 51, 102, 0.80)), url('https://images.unsplash.com/photo-1571968624832-ce960b3ec953?q=80&w=2070&auto=format&fit=crop'); background-size: cover; background-position: center center; }
    .card-texto-centralizado { text-align: center; display: flex; flex-direction: column; align-items: center; }

/* ==================================================
       BLINDAGEM TOTAL: RANK (HISCORE) E SINOPSE
       ================================================== */
    
    /* 1. BLINDAGEM DO FUNDO (OVERLAY) 
       Usamos os IDs espec√≠ficos para garantir que sobreponham qualquer regra do index.html */
    #hiscore-modal,
    #synopsis-modal {
        position: fixed !important; /* !important garante que nada mude a posi√ß√£o */
        top: 0 !important;
        left: 0 !important;
        width: 100% !important;
        height: 100% !important;
        background: rgba(0,0,0,0.5) !important;
        z-index: 99999 !important; /* Valor alt√≠ssimo para ficar acima de tudo */
        
        /* Garante o alinhamento central */
        display: none; /* O JS muda isso para flex, mas come√ßamos oculto */
        justify-content: center;
        align-items: center;
        padding: 20px;
        
        /* Reseta transforma√ß√µes que podem vir de fora */
        transform: none !important;
        opacity: 1 !important;
        visibility: visible;
    }

    /* 2. BLINDAGEM DA CAIXA DE CONTE√öDO (A JANELA EM SI) */
    #hiscore-modal .modal-content,
    #synopsis-modal .modal-content {
        /* Estrutura Visual */
        background: white !important;
        width: 100% !important;
        max-width: 500px !important;
        border-radius: 15px !important;
        padding: 25px !important;
        position: relative !important;
        box-shadow: 0 5px 25px rgba(0,0,0,0.3) !important;
        
        /* Reset de Texto (A blindagem que fizemos antes) */
        text-align: left !important;
        font-family: 'Poppins', sans-serif !important;
        font-size: 1rem !important;
        line-height: 1.5 !important;
        color: #4B4B4B !important;
        font-weight: 400 !important;
        float: none !important;
        display: block !important; /* Garante que a caixa apare√ßa */
        margin: auto !important; /* Centraliza no flex container */
    }

    /* 3. RESET DE ELEMENTOS INTERNOS (Para ignorar CSS global) */
    #hiscore-modal .modal-content h3,
    #synopsis-modal .modal-content h3 {
        color: #003366 !important; /* Azul Marinho */
        font-size: 1.5rem !important;
        margin-bottom: 20px !important;
        text-align: center !important;
        font-weight: 700 !important;
        border: none !important;
        display: block !important;
    }

    #hiscore-modal .modal-content p, 
    #synopsis-modal .modal-content p,
    #synopsis-modal .modal-content div {
        color: #555 !important;
        margin-bottom: 1rem;
        line-height: 1.6 !important;
    }

    /* 4. BLINDAGEM DO BOT√ÉO FECHAR (X) */
    #hiscore-modal .modal-close,
    #synopsis-modal .modal-close {
        all: unset !important; /* Remove qualquer heran√ßa do index */
        position: absolute !important;
        top: 15px !important;
        right: 15px !important;
        width: 30px !important;
        height: 30px !important;
        font-size: 1.8rem !important;
        color: #999 !important;
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
        cursor: pointer !important;
        background: transparent !important;
        border: none !important;
    }
    
    #hiscore-modal .modal-close:hover,
    #synopsis-modal .modal-close:hover {
        color: #dc3545 !important; /* Vermelho Erro */
    }

    /* 5. LISTA DE RANKING (Espec√≠fica do Hiscore) */
    #hiscore-modal .hiscore-item { 
        display: flex !important; 
        justify-content: space-between !important; 
        padding: 10px !important; 
        border-bottom: 1px solid #eee !important; 
        align-items: center !important; 
        background: transparent !important;
    }
    
    #hiscore-modal .hiscore-rank { 
        font-weight: bold !important; 
        width: 30px !important; 
        height: 30px !important; 
        background: #003366 !important; 
        color: white !important; 
        border-radius: 50% !important; 
        display: flex !important; 
        align-items: center !important; 
        justify-content: center !important; 
        font-size: 0.9em !important; 
        margin-right: 10px !important;
    }
    
    #hiscore-modal .hiscore-points { 
        color: #DAA520 !important; /* Dourado */
        font-weight: 700 !important; 
    }

    @media (max-width: 768px) {
        .jornal-section-title { font-size: 1.5em; }
        .destaque-container { padding: 30px 20px; }
        .hobby-content { grid-template-columns: 1fr; grid-template-rows: auto auto; }
        .hobby-foto { height: 300px; width: 100%; }
        .hobby-texto { padding: 30px 20px; text-align: center; }
        .hobby-quote-box { text-align: left; font-style: italic; }
        .hobby-tag { margin-bottom: 10px; }
    }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
</style>
</head>
<body>

  <div id="menu-placeholder"></div>

  <main class="jornal-main">

    <section id="tema-mes"></section>

    <section id="cultura">
        <h2 class="jornal-section-title">Indica a√≠ üé¨</h2>
        <div id="cultura-container" class="cards-grid"></div>
        <div class="suggestion-section">
            <button id="btn-toggle-suggestion" class="btn-suggestion">
                Indique o pr√≥ximo filme do m√™s <i class="fas fa-bullhorn"></i>
            </button>
            <div id="suggestion-form-container" class="suggestion-card-form">
                <h3 style="color: var(--azul-marinho); margin-bottom: 20px; text-align: center;">Sua Sugest√£o</h3>
                <div class="form-group"><label>Seu Nome:</label><input type="text" id="suggest-name" placeholder="Ex: Maria Silva"></div>
                <div class="form-group"><label>Filme Sugerido:</label><input type="text" id="suggest-movie" placeholder="Ex: A Procura da Felicidade"></div>
                <button id="btn-submit-suggestion" class="btn-submit-suggestion">Enviar Sugest√£o</button>
            </div>
        </div>
    </section>

    <section id="hobbies">
        <h2 class="jornal-section-title">‚ú® Al√©m do Crach√°</h2>
        <div id="hobby-container" class="hobby-container"></div>
        <div class="suggestion-section">
            <button id="btn-toggle-hobby-suggestion" class="btn-suggestion">
                <i class="fas fa-user-plus"></i>&nbsp; Indique o pr√≥ximo entrevistado
            </button>
            <div id="hobby-suggestion-form-container" class="suggestion-card-form">
                <h3 style="color: var(--azul-marinho); margin-bottom: 20px; text-align: center;">Indica√ß√£o "Al√©m do Crach√°"</h3>
                <div class="form-group"><label>Seu Nome:</label><input type="text" id="hobby-suggest-from" placeholder="Ex: Jo√£o"></div>
                <div class="form-group"><label>Quem voc√™ indica:</label><input type="text" id="hobby-suggest-target" placeholder="Ex: Maria (Log√≠stica)"></div>
                <div class="form-group"><label>Por que? (Opcional):</label><textarea id="hobby-suggest-reason" rows="2" placeholder="Ela faz pinturas incr√≠veis..."></textarea></div>
                <button id="btn-submit-hobby-suggestion" class="btn-submit-suggestion">Enviar Indica√ß√£o</button>
            </div>
        </div>
    </section>

    <section id="bem-estar-fisico">
        <h2 class="jornal-section-title">üåø Bem-estar e Sa√∫de</h2>
        <div id="saude-fisica-hero"></div>
    </section>

    <section id="receitas">
        <h2 class="jornal-section-title">üçé Receitas Saud√°veis</h2>
        <div id="receitas-container" class="cards-grid"></div>
        <div class="suggestion-section">
            <button id="btn-toggle-recipe" class="btn-suggestion">
                Indique a pr√≥xima receita do m√™s ü•ó
            </button>
            <div id="recipe-form-container" class="suggestion-card-form">
                <h3 style="color: var(--azul-marinho); margin-bottom: 20px; text-align: center;">Compartilhe sua Receita</h3>
                <div class="form-group"><label>Seu Nome:</label><input type="text" id="recipe-author" placeholder="Ex: Jo√£o da Silva"></div>
                <div class="form-group"><label>Nome do Prato:</label><input type="text" id="recipe-name" placeholder="Ex: Salada Colorida"></div>
                <button id="btn-submit-recipe" class="btn-submit-suggestion">Registrar Receita</button>
            </div>
        </div>
    </section>

    <section id="desafios">
        <h2 class="jornal-section-title" id="titulo-desafio-mes">üí™ Desafio do M√™s</h2>
        <p class="section-description">üéØ Voc√™ conseguiu alcan√ßar a meta? Vote se bateu ou n√£o o desafio.</p>
        <div id="desafios-container" class="cards-grid"></div>
        <div class="testimonials-section">
            <h3>Compartilhe como tem sido a sua experi√™ncia com o desafio.</h3>
            <button id="btn-toggle-testimonial" class="btn-suggestion" style="margin-top: 15px;">Deixar depoimento</button>
            <div id="testimonial-form-container" class="suggestion-card-form">
                <h4 style="margin-bottom: 15px; color: var(--azul-marinho);">Seu Depoimento</h4>
                <div class="form-group"><label>Seu Nome:</label><input type="text" id="testim-name" placeholder="Ex: Maria (RH)"></div>
                <div class="form-group"><label>Depoimento:</label><textarea id="testim-text" rows="3" placeholder="Conte como foi sua experi√™ncia com os desafios..."></textarea></div>
                <button id="btn-submit-testimonial" class="btn-submit-suggestion">Enviar Depoimento</button>
            </div>
            <div id="testimonials-display" class="testimonials-grid"></div>
        </div>
    </section>

    <section id="elogios">
        <h2 class="jornal-section-title">üåü Elogie o seu Amigo</h2>
        <div class="praise-header">
            <p class="section-description">Todo in√≠cio de m√™s as mensagens s√£o renovadas, mas podem ser consultadas no registro abaixo. Espalhe gratid√£o!</p>
            <div id="praise-archive-links" class="praise-archive-links"></div>
        </div>
        <div class="suggestion-section">
            <button id="btn-toggle-praise" class="btn-suggestion">
                <i class="fas fa-heart"></i>&nbsp; Enviar um Elogio
            </button>
            <div id="praise-form-container" class="suggestion-card-form">
                <h3 style="color: var(--azul-marinho); margin-bottom: 20px; text-align: center;">Envie um Elogio</h3>
                <div class="form-group"><label>Seu Nome:</label><input type="text" id="praise-from" placeholder="Ex: Carlos (Financeiro)"></div>
                <div class="form-group"><label>Para quem:</label><input type="text" id="praise-to" placeholder="Ex: Ana (RH)"></div>
                <div class="form-group"><label>Mensagem:</label><textarea id="praise-msg" rows="3" placeholder="Obrigado pela ajuda no projeto..."></textarea></div>
                <button id="btn-submit-praise" class="btn-submit-suggestion">Publicar Elogio</button>
            </div>
        </div>
        <div id="praise-container" class="cards-grid" style="margin-top: 40px;"></div>
    </section>

    <section id="sustentabilidade">
        <h2 class="jornal-section-title">Sustentabilidade e Seguran√ßa</h2>
        <div style="display: flex; gap: 10px; margin-bottom: 2rem; border-bottom: 2px solid #eee; flex-wrap: wrap; justify-content: center;">
            <button class="tab-btn active" onclick="mostrarAba('seguranca', this)" style="background: none; border: none; padding: 15px 20px; font-weight: 600; color: var(--azul-marinho); cursor: pointer; border-bottom: 3px solid var(--dourado); font-size: 1rem; font-family: inherit;">
                <i class="fas fa-shield-alt"></i> Seguran√ßa do Trabalho
            </button>
            <button class="tab-btn" onclick="mostrarAba('meio-ambiente', this)" style="background: none; border: none; padding: 15px 20px; font-weight: 600; color: #999; cursor: pointer; border-bottom: 3px solid transparent; font-size: 1rem; font-family: inherit;">
                <i class="fas fa-leaf"></i> Meio Ambiente
            </button>
        </div>
        
        <div id="seguranca" class="tab-content" style="display: block;">
            <h3 style="color: var(--azul-marinho); margin-bottom: 1.5rem; font-size: 1.5rem; text-align: center;">Seguran√ßa em Primeiro Lugar</h3>
            <div id="cards-seguranca" class="cards-grid"></div>
            <div class="quiz-container">
                <button id="btn-open-quiz" class="btn-toggle-quiz">
                    <i class="fas fa-clipboard-check"></i> Responder Quiz de Seguran√ßa
                </button>
                <div id="quiz-content">
                    <h3 style="text-align: center; color: var(--azul-marinho); margin-bottom: 10px;">Quiz da Seguran√ßa</h3>
                    <p style="text-align: center; margin-bottom: 30px; color: #666;">Teste seus conhecimentos sobre as Regras de Ouro e Procedimentos.</p>
                    <form id="safety-quiz-form">
                        <div id="quiz-questions-container"></div>
                        <button type="submit" id="btn-submit-quiz" class="btn-submit-suggestion" style="margin-top: 20px;">Enviar Respostas</button>
                        <button type="button" id="btn-reset-quiz" class="btn-suggestion" style="background: #ccc; display: none; width: 100%; margin-top: 10px;">Refazer Quiz</button>
                    </form>
                </div>
            </div>
        </div>

        <div id="meio-ambiente" class="tab-content" style="display: none;">
            <h3 style="color: var(--azul-marinho); margin-bottom: 1.5rem; font-size: 1.5rem; text-align: center;">Nosso Compromisso com o Meio Ambiente</h3>
            <p style="margin-bottom: 2rem; font-size: 1rem; line-height: 1.8; text-align: center;">Na PSR, acreditamos que a sustentabilidade n√£o √© apenas uma responsabilidade, mas uma oportunidade de criar um futuro melhor.</p>
            <div id="cards-meio-ambiente" class="cards-grid"></div>
        </div>
    </section>

    <section id="novos-clientes">
        <h2 class="jornal-section-title">Conquistas que fortalecem a nossa jornada</h2>
        <div class="clientes-header">
            <div class="stats-row">
                <div class="stat-box">
                    <div class="stat-box-inner">
                        <span class="stat-num" id="stat-qtd">--</span>
                        <span class="stat-label">Novos Clientes</span>
                    </div>
                </div>
            </div>
            <div class="data-discreta" id="stat-periodo-container">
                <i class="far fa-calendar-alt"></i> <span id="stat-periodo">Carregando...</span>
            </div>
        </div>
        <div id="lista-clientes" class="clientes-compact-list">
             <div id="lista-clientes-content">
                <div class="loading-container"><i class="fas fa-spinner fa-spin"></i> Buscando dados...</div>
             </div>
        </div>
        <div style="text-align: center; margin-top: 25px;">
            <button class="btn-ver-todos" onclick="toggleTodosClientes()">
                <i class="fas fa-chevron-down"></i> Ver lista completa
            </button>
        </div>
    </section>

    <section id="jogos">
        <h2 class="jornal-section-title">üéÆ Jogos</h2>
        <div class="hiscore-menu">
            <button class="hiscore-btn" onclick="openHiScore('BobinaWorld')"><i class="fas fa-trophy"></i> Rank BobinaWorld</button>
            <button class="hiscore-btn" onclick="openHiScore('FlapBobina')"><i class="fas fa-trophy"></i> Rank FlapBobina</button>
            <button class="hiscore-btn" onclick="openHiScore('BobinaKart')"><i class="fas fa-trophy"></i> Rank BobinaKart</button>
        </div>
        <div class="cards-grid">
            <a href="https://psrindustria.github.io/PortalPSR/marioworld.html" class="game-card">
                <img src="https://i.postimg.cc/dQgvVxWL/bobworld.jpg" class="game-banner" alt="BobinaWorld">
                <div class="game-info"><h3>BobinaWorld</h3></div>
            </a>
            <a href="https://psrindustria.github.io/PortalPSR/flappybird.html" class="game-card">
                <img src="https://i.postimg.cc/C1nt3vHR/bobfly.jpg" class="game-banner" alt="FlapBobina">
                <div class="game-info"><h3>FlapBobina</h3></div>
            </a>
            <a href="https://psrindustria.github.io/PortalPSR/bobkart.html" class="game-card">
                <img src="https://i.postimg.cc/prN7RDqp/bobcar.jpg" class="game-banner" alt="BobinaKart">
                <div class="game-info"><h3>BobinaKart</h3></div>
            </a>
        </div>
        <div class="suggestion-section">
            <button id="btn-toggle-game-suggestion" class="btn-suggestion">
                <i class="fas fa-lightbulb"></i>&nbsp; Envie sua sugest√£o de melhoria
            </button>
            <div id="game-suggestion-form-container" class="suggestion-card-form">
                <h3 style="color: var(--azul-marinho); margin-bottom: 20px; text-align: center;">Melhorias para os Jogos</h3>
                <div class="form-group"><label>Seu Nome:</label><input type="text" id="game-suggest-name" placeholder="Ex: Jo√£o"></div>
                <div class="form-group"><label>Sugest√£o:</label><textarea id="game-suggest-text" rows="3" placeholder="Poderia ter uma fase na √°gua..."></textarea></div>
                <button id="btn-submit-game-suggestion" class="btn-submit-suggestion">Enviar Sugest√£o</button>
            </div>
        </div>
    </section>

    <div id="hiscore-modal" class="modal-overlay">
        <div class="modal-content">
            <button class="modal-close" onclick="closeHiScore()">&times;</button>
            <h3 id="modal-game-title" style="color: var(--azul-marinho); text-align: center; margin-bottom: 20px;">Ranking</h3>
            <div id="modal-score-list" class="hiscore-list"></div>
        </div>
    </div>
    
    <div id="synopsis-modal" class="modal-overlay">
        <div class="modal-content">
            <button class="modal-close" onclick="closeSynopsis()">&times;</button>
            <h3 id="modal-synopsis-title" style="color: var(--azul-marinho); text-align: center; margin-bottom: 20px;">Sinopse</h3>
            <div id="modal-synopsis-text" style="color: #555; line-height: 1.6;"></div>
        </div>
    </div>

  </main>

  <div id="footer-placeholder"></div>

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-check-compat.js"></script>

  <script>
    // ==================================================================
    // 1. CONFIGURA√á√ÉO E SEGURAN√áA (APP CHECK)
    // ==================================================================
    const firebaseConfig = {
      apiKey: "AIzaSyBzMvAw9ahEyd-tSYY08HxcMzo9RKf3IFY",
      authDomain: "jornalpsr-1b8c6.firebaseapp.com",
      databaseURL: "https://jornalpsr-1b8c6-default-rtdb.firebaseio.com",
      projectId: "jornalpsr-1b8c6",
      storageBucket: "jornalpsr-1b8c6.firebasestorage.app",
      messagingSenderId: "780143103668",
      appId: "1:780143103668:web:9904f6aca1561a850951e1",
      measurementId: "G-4N0YKKY6BR"
    };

    const app = firebase.initializeApp(firebaseConfig);
    
    // --- ATEN√á√ÉO: COLE AQUI A CHAVE DO SITE (SITE KEY) ---
    // (Geralmente √© a primeira que aparece no Google. N√ÉO use a Secreta aqui!)
    const SITE_KEY = "6LcxnEYsAAAAAKeXAXw5uc7DNcF8nICSl6y_ElFr"; 

    const appCheck = firebase.appCheck();
    appCheck.activate(SITE_KEY, { isTokenAutoRefreshEnabled: true });

    // ==================================================================
    // 2. O INTERCEPTADOR M√ÅGICO (Faz o site funcionar com as Regras)
    // ==================================================================
    // Isso garante que todo "fetch" feito no site leve o crach√° de seguran√ßa junto
    const originalFetch = window.fetch;
    window.fetch = async (input, init) => {
        let url = input;
        if (input instanceof Request) { url = input.url; }

        // Se for uma chamada para o nosso Banco de Dados...
        if (typeof url === 'string' && url.includes("jornalpsr-1b8c6")) {
            try {
                // Pega o crach√° (Token) atual
                const tokenResult = await appCheck.getToken();
                const token = tokenResult.token;

                // Adiciona o crach√° no cabe√ßalho da carta (Header)
                init = init || {};
                init.headers = init.headers || {};
                if (init.headers instanceof Headers) {
                    init.headers.append('X-Firebase-AppCheck', token);
                } else {
                    init.headers['X-Firebase-AppCheck'] = token;
                }
            } catch (e) {
                console.warn("App Check: Aguardando token...", e);
            }
        }
        return originalFetch(input, init);
    };

    // ==================================================================
    // 3. SEU C√ìDIGO ORIGINAL (INTACTO)
    // ==================================================================
    
    // VARIAVEL GLOBAL VAZIA - SER√Å PREENCHIDA PELO FIREBASE
    let CONTEUDO_JORNAL = {
        temaMes: {}, bemEstar: {}, saudeFisica: {}, receitas: [], desafios: [], hobby: {}, cultura: [], sustentabilidade: { meioAmbiente: [], seguranca: [] }
    };

    const SUSTENTABILIDADE_PADRAO = {
        meioAmbiente: [
            { cor: "#4caf50", icon: "fas fa-water", titulo: "Gest√£o de √Ågua", texto: "Reuso de √°gua nos processos de produ√ß√£o." },
            { cor: "#2196f3", icon: "fas fa-lightbulb", titulo: "Energia Renov√°vel", texto: "Transi√ß√£o para energia solar." },
            { cor: "#ff9800", icon: "fas fa-trash-alt", titulo: "Redu√ß√£o de Res√≠duos", texto: "Programa de reciclagem de pap√©is e pl√°sticos." }
        ],
        seguranca: [
            { cor: "#f44336", icon: "fas fa-ban", titulo: "Regras de Ouro", lista: ["Proibido fumar no galp√£o", "Proibido celular na opera√ß√£o", "Proibido uso de adornos"] },
            { cor: "#ff9800", icon: "fas fa-hard-hat", titulo: "Uso de EPI", lista: ["Uso obrigat√≥rio de EPIs", "Sapatos de seguran√ßa e √≥culos", "Protetor auricular"] },
            { cor: "#2196f3", icon: "fas fa-comments", titulo: "DDS", lista: ["Informa√ß√£o previne acidentes", "Intera√ß√£o √© fundamental", "Siga normas"] },
            { cor: "#000000", icon: "fas fa-cogs", titulo: "NR-12", lista: ["Nunca retire prote√ß√µes das m√°quinas", "Bot√µes de emerg√™ncia acion√°veis"] }
        ]
    };

    const SAFETY_QUIZ = [
        { id: "q1", question: "O que deve ser feito caso uma prote√ß√£o de m√°quina precise ser removida?", options: ["Deixar sem prote√ß√£o", "Recolocar imediatamente ap√≥s finalizar", "Avisar o colega"], correct: 1 },
        { id: "q2", question: "Sobre o uso de celulares na √°rea operacional:", options: ["Permitido com fone", "Permitido s√≥ redes sociais", "Proibido"], correct: 2 },
        { id: "q3", question: "Se identificar dano no EPI:", options: ["Informar ao supervisor/trocar", "Usar fita", "Continuar usando"], correct: 0 },
        { id: "q4", question: "Fun√ß√£o do bot√£o de emerg√™ncia:", options: ["Desligar fim do dia", "Situa√ß√£o de risco imediato", "Produzir mais r√°pido"], correct: 1 },
        { id: "q5", question: "Objetivo do DDS:", options: ["Conversa aleat√≥ria", "Atrasar servi√ßo", "Prevenir acidentes e orientar"], correct: 2 },
        { id: "q6", question: "Onde √© proibido fumar?", options: ["Apenas escrit√≥rio", "Dentro do galp√£o e √°reas comuns", "Qualquer lugar"], correct: 1 },
        { id: "q7", question: "Risco NR-12 (M√£os):", options: ["Refeit√≥rio", "Engrenagens e partes m√≥veis", "Computador"], correct: 1 },
        { id: "q8", question: "Respons√°vel pela limpeza do EPI:", options: ["Supervisor", "Colaborador", "Faxina"], correct: 1 },
        { id: "q9", question: "Adornos (an√©is/pulseiras) na opera√ß√£o:", options: ["Sim, discretos", "N√£o, proibido", "Sim, debaixo da luva"], correct: 1 },
        { id: "q10", question: "Organiza√ß√£o do local √© dever de:", options: ["Limpeza", "Gerente", "Todos"], correct: 2 }
    ];

    const BASE_DB_URL = "https://jornalpsr-1b8c6-default-rtdb.firebaseio.com/";
    const CURRENT_MONTH_KEY = new Date().toISOString().slice(0, 7);

    function getDeviceId() { let d = localStorage.getItem('psr_device_id'); if (!d) { d = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9); localStorage.setItem('psr_device_id', d); } return d; }
    const MY_DEVICE_ID = getDeviceId();
    
    let globalChallengesData = {};
    let globalQuizData = {};
    let globalHobbyData = {}; 
    let globalPraiseData = {}; 
    let currentPraiseMonth = CURRENT_MONTH_KEY; 

    document.addEventListener("DOMContentLoaded", () => {
        // Carrega Menu e Footer
        ['menu', 'footer'].forEach(file => {
            fetch(`${file}.html?t=${Date.now()}`)
                .then(r => r.text())
                .then(html => {
                    const placeholder = document.getElementById(`${file}-placeholder`);
                    if (placeholder) placeholder.innerHTML = html;
                    
                    if (file === 'menu') {
                        const toggle = document.getElementById('menu-toggle');
                        const navEl = document.getElementById('nav-principal'); 
                        
                        if (toggle && navEl) {
                            toggle.addEventListener('click', () => {
                                navEl.classList.toggle('active'); 
                            });
                            
                            navEl.querySelectorAll('a').forEach(link => {
                                link.addEventListener('click', () => {
                                    navEl.classList.remove('active');
                                });
                            });
                        }
                    }
                })
                .catch(e => console.error(`Error loading ${file}.html:`, e));
        });

        initFirebaseData();
        setupToggle('btn-toggle-suggestion', 'suggestion-form-container');
        setupToggle('btn-toggle-recipe', 'recipe-form-container');
        setupToggle('btn-toggle-testimonial', 'testimonial-form-container');
        setupToggle('btn-toggle-praise', 'praise-form-container');
        setupToggle('btn-toggle-hobby-suggestion', 'hobby-suggestion-form-container');
        setupToggle('btn-toggle-game-suggestion', 'game-suggestion-form-container');
    });

    async function initFirebaseData() {
        try {
            const [
                contentResp, 
                clientesResp,
                hobbyResp, 
                praiseResp, 
                challengesResp, 
                quizResp,
                ratingsResp,
                testimonialsResp
            ] = await Promise.all([
                fetch(BASE_DB_URL + "content.json"),
                fetch(BASE_DB_URL + "novos_clientes.json"),
                fetch(BASE_DB_URL + "hobby_interactions_history/" + CURRENT_MONTH_KEY + ".json"),
                fetch(BASE_DB_URL + "praise_messages.json"),
                fetch(BASE_DB_URL + "challenges_v2.json"),
                fetch(BASE_DB_URL + "safety_quiz.json"),
                fetch(BASE_DB_URL + "ratings_v2.json"),
                fetch(BASE_DB_URL + "testimonials_history/" + CURRENT_MONTH_KEY + ".json")
            ]);

            const contentData = await contentResp.json() || {};
            if (contentData) {
                CONTEUDO_JORNAL = contentData;
                if(!CONTEUDO_JORNAL.sustentabilidade) CONTEUDO_JORNAL.sustentabilidade = SUSTENTABILIDADE_PADRAO;
            }

            const clientesData = await clientesResp.json() || {};
            renderNovosClientes(clientesData);

            globalHobbyData = await hobbyResp.json() || {};
            globalPraiseData = await praiseResp.json() || {};
            globalChallengesData = await challengesResp.json() || {}; 
            globalQuizData = await quizResp.json() || {};
            const ratingsData = await ratingsResp.json() || {};
            const testimonialsData = await testimonialsResp.json() || {};

            renderJornal(); 

            renderChallenges(globalChallengesData);
            renderPraiseSection(currentPraiseMonth);
            renderTestimonials(testimonialsData);
            checkIfQuizTaken();
            
            document.querySelectorAll('.rating-container').forEach(container => {
                const itemId = container.dataset.id;
                const stars = container.querySelectorAll('.rating-stars i');
                const scoreDisplay = container.querySelector('.score-value');
                const itemVotes = ratingsData[itemId] || {};
                
                const calcRender = (votes) => {
                    const vals = Object.values(votes);
                    let avg = vals.length > 0 ? (vals.reduce((a,b)=>a+b,0)/vals.length).toFixed(1) : "0.0";
                    scoreDisplay.textContent = avg;
                    updateVisualStars(stars, avg);
                    if (votes[MY_DEVICE_ID]) container.querySelector('.rating-stars').classList.add('voted');
                };
                
                calcRender(itemVotes);
                
                stars.forEach(star => {
                    star.addEventListener('click', async () => {
                        const val = parseInt(star.dataset.value);
                        if(!itemVotes[MY_DEVICE_ID]) {
                             itemVotes[MY_DEVICE_ID] = val;
                             calcRender(itemVotes);
                             await fetch(`${BASE_DB_URL}ratings_v2/${itemId}/${MY_DEVICE_ID}.json`, { method: 'PUT', body: JSON.stringify(val) });
                        }
                    });
                    star.addEventListener('mouseover', () => {
                        const val = parseInt(star.dataset.value);
                        stars.forEach(s => { 
                            s.classList.remove('filled'); 
                            if(parseInt(s.dataset.value)<=val) s.classList.add('hover-active'); 
                            else s.classList.remove('hover-active'); 
                        });
                    });
                    star.addEventListener('mouseout', () => { 
                        stars.forEach(s => s.classList.remove('hover-active')); 
                        updateVisualStars(stars, scoreDisplay.textContent); 
                    });
                });
            });

        } catch (e) { console.error("Erro no carregamento paralelo:", e); }
        
        setupForms(); 
    }

    function renderJornal() {
        const tm = CONTEUDO_JORNAL.temaMes || {}; 
        document.getElementById('tema-mes').innerHTML = `<div class="destaque-container tema-mes-bg"><div class="destaque-icon">ü§ç</div><h2>${tm.titulo||'Tema do M√™s'}</h2><p><strong>${tm.subtitulo||''}</strong></p><p style="font-size: 1em; max-width: 800px; margin: 10px auto;">${tm.resumo||''}</p><button id="btnLerMais" class="btn-ler-mais" onclick="toggleMateria()">Ler mais sobre o tema</button><div id="materiaCompleta" class="materia-completa">${tm.conteudoCompleto||''}<p class="fonte-materia"><small>Cliqui para ler a mat√©ria completa: <a href="${tm.fonte?.link||'#'}" target="_blank">${tm.fonte?.texto||'Fonte'}</a></small></p></div></div>`;
        
        const h = CONTEUDO_JORNAL.hobby || {};
        const hData = globalHobbyData || {};
        const hLikes = hData.likes || {};
        const hComments = hData.comments ? Object.values(hData.comments) : [];
        const hUserLiked = hLikes[MY_DEVICE_ID] ? 'liked' : '';
        const hHeartIcon = hUserLiked ? 'fas' : 'far';
        hComments.sort((a,b) => new Date(b.date) - new Date(a.date));

        document.getElementById('hobby-container').innerHTML = `
            <div class="hobby-content">
                <div class="hobby-foto"><img src="${h.foto||''}" alt="${h.nome||''}"></div>
                <div class="hobby-texto">
                    <h3>${h.nome||'Colega'}</h3>
                    <div class="hobby-titulo">${h.cargo||''}</div>
                    <div class="hobby-quote-box"><i class="fas fa-quote-left"></i><p>${(h.texto||'').replace(/"/g, '')}</p></div>
                    <div class="hobby-hobbies"><div class="hobby-list">${(h.tags||[]).map(t => `<span class="hobby-tag">${t}</span>`).join('')}</div></div>
                    <div class="hobby-actions">
                        <button class="hobby-btn-action ${hUserLiked}" onclick="likeHobby()"><i class="${hHeartIcon} fa-heart"></i> ${Object.keys(hLikes).length} Curtidas</button>
                        <button class="hobby-btn-action" onclick="toggleHobbyComments()"><i class="far fa-comment-dots"></i> ${hComments.length} Coment√°rios</button>
                    </div>
                    <div id="hobby-comments-box" class="hobby-comments-section">
                        <div style="display:flex; gap:5px; margin-bottom:10px;"><input type="text" id="input-hobby-comment" placeholder="Comente..." style="flex:1; padding:8px; border:1px solid #ddd; border-radius:20px;"><button onclick="sendHobbyComment()" style="border:none; background:var(--azul-marinho); color:white; border-radius:50%; width:35px; height:35px; cursor:pointer;"><i class="fas fa-paper-plane"></i></button></div>
                        <div class="hobby-comments-list">${hComments.length > 0 ? hComments.map(c => `<div class="hobby-comment-item"><strong>${c.author || 'Colega'}:</strong> ${c.text}</div>`).join('') : '<p style="color:#999; text-align:center;">Seja o primeiro a comentar!</p>'}</div>
                    </div>
                </div>
            </div>`;
        
        const sf = CONTEUDO_JORNAL.saudeFisica || {}; 
        document.getElementById('saude-fisica-hero').innerHTML = `<div class="jornal-card"><div class="banner-metade banner-saude-fisica">üèÉ</div><div class="jornal-card-content card-texto-centralizado"><h3>${sf.subtitulo||''}</h3><p>${sf.resumo||''}</p><button id="btnLerMaisSaudeFisica" class="btn-ler-mais" onclick="toggleSaudeFisica()">Ler sobre sa√∫de f√≠sica</button><div id="materiaSaudeFisica" class="materia-completa">${sf.conteudoCompleto||''}<p class="fonte-materia"><small>Fonte: <a href="${sf.fonte?.link||'#'}" target="_blank">${sf.fonte?.texto||'Fonte'}</a></small></p></div></div></div>`;
        
        const recContainer = document.getElementById('receitas-container'); recContainer.innerHTML = ''; 
        (CONTEUDO_JORNAL.receitas||[]).forEach((r, i) => { recContainer.innerHTML += `<div class="receita-card"><div class="receita-imagem">${r.emoji}</div><div class="receita-info"><h4>${r.titulo}</h4><div class="receita-tempo">‚è±Ô∏è ${r.tempo}</div><p class="indicacao-texto"><strong>Indicado por:</strong> ${r.indicadoPor}</p><p>${r.desc}</p><button class="btn-ver-receita" onclick="toggleReceita('receita-${i}')">Ver Receita</button><div id="receita-${i}" class="receita-detalhes"><h5>Ingredientes:</h5><ul>${(r.ingredientes||[]).map(x=>`<li>${x}</li>`).join('')}</ul><h5>Modo de Preparo:</h5><ol>${(r.preparo||[]).map(x=>`<li>${x}</li>`).join('')}</ol></div></div></div>`; });
        
        const meses = ["Janeiro", "Fevereiro", "Mar√ßo", "Abril", "Maio", "Junho", "Julho", "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro"];
        document.getElementById('titulo-desafio-mes').innerText = `üí™ Desafio do M√™s de ${meses[new Date().getMonth()]}`;

        const desContainer = document.getElementById('desafios-container'); desContainer.innerHTML = ''; 
        (CONTEUDO_JORNAL.desafios||[]).forEach(d => { desContainer.innerHTML += `<div class="desafio-saude-card" data-challenge-id="${d.id}"><h4><span style="font-size:1.5em; margin-right:5px;">${d.emoji}</span> ${d.titulo}</h4><p>${d.desc}</p><div style="margin-top:auto; padding-top:15px; border-top:1px solid #eee;"><div class="challenge-buttons"><button class="btn-challenge success" onclick="voteChallenge('${d.id}', 'success')">‚úÖ Consegui</button><button class="btn-challenge fail" onclick="voteChallenge('${d.id}', 'fail')">‚ùå N√£o Consegui</button></div><div class="challenge-stats"><span>Consegui: <strong class="stat-success">0</strong></span><span>N√£o Consegui: <strong class="stat-fail">0</strong></span></div></div></div>`; });
        
        const cultContainer = document.getElementById('cultura-container'); 
        cultContainer.innerHTML = ''; 
        (CONTEUDO_JORNAL.cultura||[]).forEach(c => { 
            const ic = c.tipo==='livro'?'fa-book-open':'fa-play-circle'; 
            cultContainer.innerHTML += `
                <article class="jornal-card" id="card_${c.id}">
                    <a href="${c.link}" target="_blank" class="video-thumbnail-container">
                        <img src="${c.img}">
                        <i class="fas ${ic} play-button"></i>
                    </a>
                    <div class="jornal-card-content" style="text-align:center;">
                        <h3>${c.titulo}</h3>
                        <p class="indicacao-texto"><strong>Indicado por:</strong> ${c.indicadoPor}</p>
                        <button class="btn-ler-sinopse" onclick="openSynopsis('${c.id}')">Ler Sinopse</button>
                        <span class="tag-discreta">${c.tag||''}</span>
                        <div class="rating-container" data-id="${c.id}">
                            <div class="rating-stars"><i class="far fa-star" data-value="1"></i><i class="far fa-star" data-value="2"></i><i class="far fa-star" data-value="3"></i><i class="far fa-star" data-value="4"></i><i class="far fa-star" data-value="5"></i></div>
                            <div style="font-size:0.9rem; color:#777; margin-top:10px;">M√©dia:<br><span class="score-value">0.0</span></div>
                        </div>
                    </div>
                </article>`; 
        });

        const maContainer = document.getElementById('cards-meio-ambiente'); maContainer.innerHTML = '';
        CONTEUDO_JORNAL.sustentabilidade.meioAmbiente.forEach(m => { maContainer.innerHTML += `<div class="jornal-card" style="border-top: 5px solid ${m.cor};"><div class="jornal-card-content"><h3 style="color: ${m.cor}; font-size: 1.2em;"><i class="${m.icon}"></i> ${m.titulo}</h3><p>${m.texto}</p></div></div>`; });

        const segContainer = document.getElementById('cards-seguranca'); segContainer.innerHTML = '';
        CONTEUDO_JORNAL.sustentabilidade.seguranca.forEach(s => { let listaHtml = s.lista.map(item => `<li>${item}</li>`).join(''); segContainer.innerHTML += `<div class="jornal-card" style="border-top: 5px solid ${s.cor};"><div class="jornal-card-content"><h3 style="color: ${s.cor}; font-size: 1.2em;"><i class="${s.icon}"></i> ${s.titulo}</h3><ul style="font-size: 0.9rem; margin-left: 15px; color: #555;">${listaHtml}</ul></div></div>`; });

        renderQuizHTML();
        setupQuizToggle();
    }

    function renderNovosClientes(dados) {
        if (!dados) return;
        if (dados.resumo) {
            document.getElementById('stat-qtd').textContent = dados.resumo.quantidade || "0";
            document.getElementById('stat-periodo').textContent = dados.resumo.periodo || "";
        }
        const listaContainer = document.getElementById('lista-clientes-content');
        listaContainer.innerHTML = ""; 
        if (dados.lista && dados.lista.length > 0) {
            dados.lista.forEach(cliente => {
                const classeDestaque = cliente.destaque ? 'destaque' : '';
                const htmlBadge = cliente.destaque ? '<span class="badge-destaque">‚ú® Destaque</span>' : '';
                const itemHtml = `<div class="cliente-item ${classeDestaque}"><span class="cliente-icon-mini">${cliente.icone || 'üè¢'}</span><div class="cliente-info"><span>${cliente.nome}</span>${htmlBadge}</div></div>`;
                listaContainer.innerHTML += itemHtml;
            });
        } else {
            listaContainer.innerHTML = '<div style="padding:20px; text-align:center; grid-column: 1 / -1;">Nenhum cliente novo neste per√≠odo.</div>';
        }
    }

    function toggleTodosClientes() {
        const lista = document.getElementById('lista-clientes');
        const btn = document.querySelector('.btn-ver-todos');
        const estaOculto = window.getComputedStyle(lista).display === 'none';
        if (estaOculto) {
            lista.style.display = 'block';
            btn.innerHTML = '<i class="fas fa-chevron-up"></i> Ocultar lista';
            btn.style.backgroundColor = 'var(--azul-marinho)';
            btn.style.color = 'white';
        } else {
            lista.style.display = 'none';
            btn.innerHTML = '<i class="fas fa-chevron-down"></i> Ver lista completa';
            btn.style.backgroundColor = 'white';
            btn.style.color = 'var(--azul-marinho)';
        }
    }

    function openSynopsis(id) {
        const item = (CONTEUDO_JORNAL.cultura||[]).find(c => c.id === id);
        if (item) {
            document.getElementById('modal-synopsis-title').textContent = item.titulo;
            document.getElementById('modal-synopsis-text').textContent = item.sinopse || item.desc || "Sinopse n√£o dispon√≠vel.";
            document.getElementById('synopsis-modal').style.display = 'flex';
        }
    }
    function closeSynopsis() { document.getElementById('synopsis-modal').style.display = 'none'; }

    window.openHiScore = async function(gameKey) {
        const modal = document.getElementById('hiscore-modal');
        const list = document.getElementById('modal-score-list');
        modal.style.display = 'flex';
        document.getElementById('modal-game-title').textContent = `Ranking: ${gameKey}`;
        list.innerHTML = '<p style="text-align:center; color:#666;">Carregando...</p>';
        try {
            const resp = await fetch(`${BASE_DB_URL}games/${gameKey}/scores.json`);
            const data = await resp.json();
            if (!data) { list.innerHTML = '<p style="text-align:center; color:#999;">Sem recordes.</p>'; return; }
            let scoresArray = Object.values(data);
            scoresArray.sort((a, b) => {
                let scoreA = parseFloat(String(a.pontos).replace(/[^\d.-]/g, '')) || 0; 
                let scoreB = parseFloat(String(b.pontos).replace(/[^\d.-]/g, '')) || 0; 
                return scoreB - scoreA;
            });
            list.innerHTML = scoresArray.slice(0, 10).map((s, index) => `<div class="hiscore-item"><div class="hiscore-rank" style="background:${index < 3 ? 'var(--dourado)' : 'var(--azul-marinho)'}">${index + 1}</div><div style="flex:1; margin-left:10px; font-weight:600;">${s.nome || 'An√¥nimo'}</div><div class="hiscore-points">${s.pontos}</div></div>`).join('');
        } catch (error) { console.error(error); list.innerHTML = '<p style="color:red;">Erro ao carregar.</p>'; }
    }
    window.closeHiScore = function() { document.getElementById('hiscore-modal').style.display = 'none'; }

    function renderQuizHTML() {
        const container = document.getElementById('quiz-questions-container');
        container.innerHTML = '';
        SAFETY_QUIZ.forEach((q, index) => {
            let optionsHtml = q.options.map((opt, i) => `<label class="quiz-option"><input type="radio" name="${q.id}" value="${i}"> ${opt}</label>`).join('');
            container.innerHTML += `<div class="quiz-question" id="quiz-block-${q.id}"><h4>${index + 1}. ${q.question}</h4><div style="display:flex; flex-direction:column; gap:5px;">${optionsHtml}</div><div class="quiz-stats"><div class="quiz-bar" id="bar-${q.id}"></div><div class="quiz-bar-text" id="text-${q.id}">0% acertaram</div></div></div>`;
        });
    }
    
    function setupQuizToggle() {
        const btn = document.getElementById('btn-open-quiz');
        const content = document.getElementById('quiz-content');
        if (btn && content) {
            btn.onclick = () => {
                if(content.style.display === 'block') { content.style.display = 'none'; btn.innerHTML = '<i class="fas fa-clipboard-check"></i> Responder Quiz de Seguran√ßa'; }
                else { content.style.display = 'block'; btn.innerHTML = '<i class="fas fa-chevron-up"></i> Fechar Quiz'; }
            };
        }
    }

    function checkIfQuizTaken() {
        let hasTaken = false;
        for (const qId in globalQuizData) { if (globalQuizData[qId] && globalQuizData[qId][MY_DEVICE_ID] !== undefined) { hasTaken = true; break; } }
        if (hasTaken) lockQuizUI();
    }
    function lockQuizUI() {
        document.getElementById('safety-quiz-form').classList.add('quiz-locked');
        document.getElementById('btn-submit-quiz').style.display = 'none';
        document.getElementById('btn-reset-quiz').style.display = 'block';
        SAFETY_QUIZ.forEach(q => {
            const userAns = globalQuizData[q.id] ? globalQuizData[q.id][MY_DEVICE_ID] : null;
            const block = document.getElementById(`quiz-block-${q.id}`);
            block.querySelectorAll('input').forEach(inp => inp.disabled = true);
            if (userAns !== undefined && userAns !== null) {
                const correctLabel = block.querySelectorAll('.quiz-option')[q.correct];
                if(correctLabel) correctLabel.classList.add('correct-answer');
            }
            const qData = globalQuizData[q.id] || {};
            const total = Object.keys(qData).length;
            let correct = 0; Object.values(qData).forEach(v => {if(v) correct++});
            const pct = total>0 ? Math.round((correct/total)*100) : 0;
            block.querySelector('.quiz-stats').style.display = 'block';
            const bar = document.getElementById(`bar-${q.id}`);
            bar.style.width = `${pct}%`;
            document.getElementById(`text-${q.id}`).textContent = `${pct}% acertaram`;
            bar.style.backgroundColor = pct<50?'var(--vermelho-erro)':'var(--verde-sucesso)';
        });
    }

    document.getElementById('safety-quiz-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        const updates = {};
        for (const q of SAFETY_QUIZ) {
            const selected = document.querySelector(`input[name="${q.id}"]:checked`);
            if (!selected) { alert(`Responda a quest√£o ${q.id.replace('q','')}`); return; }
            const isCorrect = (parseInt(selected.value) === q.correct);
            if (!globalQuizData[q.id]) globalQuizData[q.id] = {};
            globalQuizData[q.id][MY_DEVICE_ID] = isCorrect;
            updates[`safety_quiz/${q.id}/${MY_DEVICE_ID}`] = isCorrect;
        }
        await fetch(BASE_DB_URL + ".json", { method: 'PATCH', body: JSON.stringify(updates) });
        lockQuizUI();
    });
    
    document.getElementById('btn-reset-quiz').addEventListener('click', async()=>{
        if(!confirm("Refazer?")) return;
        const updates = {};
        SAFETY_QUIZ.forEach(q => updates[`safety_quiz/${q.id}/${MY_DEVICE_ID}`] = null);
        await fetch(BASE_DB_URL + ".json", { method: 'PATCH', body: JSON.stringify(updates) });
        location.reload();
    });

    async function voteChallenge(cId, type) {
        if(!globalChallengesData[cId]) globalChallengesData[cId] = {};
        globalChallengesData[cId][MY_DEVICE_ID] = type;
        renderChallenges(globalChallengesData);
        await fetch(`${BASE_DB_URL}challenges_v2/${cId}/${MY_DEVICE_ID}.json`, { method: 'PUT', body: JSON.stringify(type) });
    }
    function renderChallenges(data) {
        document.querySelectorAll('.desafio-saude-card').forEach(card => {
            const id = card.dataset.challengeId;
            const cData = data[id] || {};
            let s=0, f=0, my=null;
            for(const [k,v] of Object.entries(cData)) { if(v==='success') s++; else f++; if(k===MY_DEVICE_ID) my=v; }
            card.querySelector('.stat-success').textContent = s;
            card.querySelector('.stat-fail').textContent = f;
            card.querySelector('.btn-challenge.success').classList.toggle('active', my==='success');
            card.querySelector('.btn-challenge.fail').classList.toggle('active', my==='fail');
        });
    }

    function renderPraiseSection(selectedMonth) {
        currentPraiseMonth = selectedMonth;
        const container = document.getElementById('praise-container');
        const linksContainer = document.getElementById('praise-archive-links');
        container.innerHTML = ''; linksContainer.innerHTML = '';
        const dataMonths = new Set();
        dataMonths.add(new Date().toISOString().slice(0, 7));
        Object.values(globalPraiseData).forEach(msg => { if(msg.date) dataMonths.add(msg.date.slice(0, 7)); });
        Array.from(dataMonths).sort().reverse().forEach(mStr => {
            const [y, m] = mStr.split('-');
            const label = new Date(y, m - 1, 1).toLocaleDateString('pt-BR', { month: 'long', year: 'numeric' }).toUpperCase();
            const link = document.createElement('span'); link.className = `praise-link ${mStr === currentPraiseMonth ? 'active' : ''}`;
            link.textContent = label; link.onclick = () => renderPraiseSection(mStr);
            linksContainer.appendChild(link);
        });
        const msgs = Object.entries(globalPraiseData)
            .filter(([_, d]) => d.date && d.date.startsWith(selectedMonth))
            .sort((a,b) => new Date(b[1].date) - new Date(a[1].date));
        
        if (msgs.length === 0) container.innerHTML = '<p style="text-align:center; color:#999; width:100%;">Nenhum elogio neste m√™s.</p>';
        msgs.forEach(([id, msg]) => {
            const likes = msg.likes || {};
            const userLiked = likes[MY_DEVICE_ID] ? 'liked' : '';
            container.innerHTML += `
            <div class="praise-card">
                <div style="border-bottom:1px solid #eee; padding-bottom:8px; margin-bottom:10px; color:#777; font-size:0.9em;">De: <strong>${msg.from}</strong> <br> Para: <strong>${msg.to}</strong></div>
                <p style="font-style:italic; color:#444; margin-bottom:15px;">"${msg.message}"</p>
                <div style="margin-top:auto; display:flex; justify-content:space-between; color:#999; font-size:0.8em;">
                    <span>${new Date(msg.date).toLocaleDateString('pt-BR')}</span>
                    <button class="praise-like-btn ${userLiked}" onclick="likePraise('${id}')" style="background:none; border:none; cursor:pointer;"><i class="${userLiked?'fas':'far'} fa-heart"></i> ${Object.keys(likes).length}</button>
                </div>
            </div>`;
        });
    }
    
    async function likePraise(id) {
        const url = `${BASE_DB_URL}praise_messages/${id}/likes/${MY_DEVICE_ID}.json`;
        const exists = globalPraiseData[id].likes && globalPraiseData[id].likes[MY_DEVICE_ID];
        if(exists) { await fetch(url, {method:'DELETE'}); delete globalPraiseData[id].likes[MY_DEVICE_ID]; }
        else { await fetch(url, {method:'PUT', body:JSON.stringify(true)}); if(!globalPraiseData[id].likes) globalPraiseData[id].likes={}; globalPraiseData[id].likes[MY_DEVICE_ID]=true; }
        renderPraiseSection(currentPraiseMonth);
    }

    async function submitPraise() {
        const f=document.getElementById('praise-from').value, t=document.getElementById('praise-to').value, m=document.getElementById('praise-msg').value;
        if(f&&t&&m) { await fetch(`${BASE_DB_URL}praise_messages.json`, {method:'POST', body:JSON.stringify({from:f, to:t, message:m, date:new Date().toISOString()})}); location.reload(); }
    }
    
    async function likeHobby() {
        const url = `${BASE_DB_URL}hobby_interactions_history/${CURRENT_MONTH_KEY}/likes/${MY_DEVICE_ID}.json`;
        const exists = globalHobbyData.likes && globalHobbyData.likes[MY_DEVICE_ID];
        if(exists) { await fetch(url, {method:'DELETE'}); delete globalHobbyData.likes[MY_DEVICE_ID]; }
        else { await fetch(url, {method:'PUT', body:JSON.stringify(true)}); if(!globalHobbyData.likes) globalHobbyData.likes={}; globalHobbyData.likes[MY_DEVICE_ID]=true; }
        renderJornal();
    }
    async function sendHobbyComment() {
        const txt = document.getElementById('input-hobby-comment').value;
        if(txt) {
            const author = prompt("Seu nome:") || "An√¥nimo";
            await fetch(`${BASE_DB_URL}hobby_interactions_history/${CURRENT_MONTH_KEY}/comments.json`, {method:'POST', body:JSON.stringify({text:txt, author, date:new Date().toISOString()})});
            // Recarrega apenas a parte de hobby/comments
            const resp = await fetch(BASE_DB_URL + "hobby_interactions_history/" + CURRENT_MONTH_KEY + ".json");
            globalHobbyData = await resp.json() || {};
            renderJornal();
        }
    }

    function renderTestimonials(data) {
        const container = document.getElementById('testimonials-display');
        container.innerHTML = '';
        const sorted = Object.entries(data).sort((a,b)=>new Date(b[1].date)-new Date(a[1].date)).slice(0,3);
        if(sorted.length===0) { container.innerHTML='<p style="color:#999;font-style:italic;">Seja o primeiro a compartilhar!</p>'; return; }
        sorted.forEach(([id, t]) => {
            container.innerHTML += `
            <div style="background:#f4f7f9; padding:20px; border-radius:10px; border-top:4px solid var(--dourado); text-align:left;">
                <span style="font-weight:700; color:var(--azul-marinho);">${t.name}</span>
                <p style="font-style:italic; color:#555;">"${t.text}"</p>
            </div>`;
        });
    }

    function toggleGeneric(c, b, o, f) { const el=document.getElementById(c), btn=document.getElementById(b); if(el.style.display==='block'){el.style.display='none';btn.innerText=o;btn.style.background='var(--azul-marinho)';btn.style.color='white';}else{el.style.display='block';btn.innerText=f;btn.style.background='white';btn.style.color='var(--azul-marinho)';btn.style.border='2px solid var(--azul-marinho)';}}
    function toggleMateria() { toggleGeneric('materiaCompleta', 'btnLerMais', 'Ler mais sobre o tema', 'Ler menos'); }
    function toggleSaudeFisica() { toggleGeneric('materiaSaudeFisica', 'btnLerMaisSaudeFisica', 'Ler sobre sa√∫de', 'Fechar'); }
    function toggleReceita(id) { const el=document.getElementById(id); el.style.display = el.style.display==='block'?'none':'block'; }
    function toggleHobbyComments() { const el=document.getElementById('hobby-comments-box'); el.style.display=el.style.display==='block'?'none':'block'; }
    function mostrarAba(id, btn) { document.querySelectorAll('.tab-content').forEach(c=>c.style.display='none'); document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active')); document.getElementById(id).style.display='block'; btn.classList.add('active'); }
    function updateVisualStars(stars, val) { const r=Math.round(val); stars.forEach(s=>{ s.classList.remove('fas','filled','hover-active'); s.classList.add('far'); if(parseInt(s.dataset.value)<=r) {s.classList.remove('far'); s.classList.add('fas','filled');} }); }
    function setupToggle(b,f){ const btn=document.getElementById(b), frm=document.getElementById(f); if(btn&&frm) btn.addEventListener('click',()=>frm.style.display=frm.style.display==='block'?'none':'block'); }
    function setupForms() {
        const btnS=document.getElementById('btn-submit-suggestion'); if(btnS) btnS.onclick=async()=>{const n=document.getElementById('suggest-name').value, m=document.getElementById('suggest-movie').value; if(n&&m){await fetch(`${BASE_DB_URL}suggestions.json`,{method:'POST',body:JSON.stringify({name:n,movie:m,date:new Date()})}); alert('Enviado!'); location.reload();}};
        const btnR=document.getElementById('btn-submit-recipe'); if(btnR) btnR.onclick=async()=>{const a=document.getElementById('recipe-author').value, d=document.getElementById('recipe-name').value; if(a&&d){await fetch(`${BASE_DB_URL}recipe_suggestions.json`,{method:'POST',body:JSON.stringify({author:a,dish:d,date:new Date()})}); alert('Enviado!'); location.reload();}};
        const btnT=document.getElementById('btn-submit-testimonial'); if(btnT) btnT.onclick=async()=>{const n=document.getElementById('testim-name').value, t=document.getElementById('testim-text').value; if(n&&t){await fetch(`${BASE_DB_URL}testimonials_history/${CURRENT_MONTH_KEY}.json`,{method:'POST',body:JSON.stringify({name:n,text:t,date:new Date()})}); alert('Enviado!'); initFirebaseData();}};
        const btnP=document.getElementById('btn-submit-praise'); if(btnP) btnP.onclick=submitPraise;
        const btnG=document.getElementById('btn-submit-game-suggestion'); if(btnG) btnG.onclick=async()=>{const n=document.getElementById('game-suggest-name').value, t=document.getElementById('game-suggest-text').value; if(n&&t){await fetch(`${BASE_DB_URL}game_suggestions.json`,{method:'POST',body:JSON.stringify({name:n,text:t,date:new Date()})}); alert('Enviado!'); location.reload();}};
        const btnH=document.getElementById('btn-submit-hobby-suggestion'); if(btnH) btnH.onclick=async()=>{const f=document.getElementById('hobby-suggest-from').value, t=document.getElementById('hobby-suggest-target').value, r=document.getElementById('hobby-suggest-reason').value; if(f&&t){await fetch(`${BASE_DB_URL}hobby_suggestions.json`,{method:'POST',body:JSON.stringify({from:f,target:t,reason:r,date:new Date()})}); alert('Enviado!'); location.reload();}};
    }
  </script>
</body>
</html>
