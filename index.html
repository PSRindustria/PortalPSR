<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>PSR Indústria</title>
  <!-- CSS principal -->
  <link rel="stylesheet" href="style.css" />
  <!-- Font Awesome -->
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
  />
</head>
<body>
  <!-- MENU (será carregado via JS) -->
  <div id="menu-placeholder"></div>

  <!-- BANNER -->
  <section class="banner" id="inicio">
    <h1>Bem-vindo à Intranet PSR Indústria</h1>
    <p>Sua fonte central de informações, notícias e recursos.</p>
    <a href="#novidades" class="banner-btn">Ver Novidades</a>
  </section>

  <main>
    <!-- Novidades -->
    <section id="novidades" class="section">
      <h2 class="section-title">Novidades</h2>
      <div class="novidades-header">
        <i class="far fa-clock"></i>
        <span id="data-hoje-novidades"></span>
      </div>
      <div id="novidades-container" class="novidades-container">
        <div class="loading"><div class="loading-spinner"></div></div>
      </div>
    </section>

    <!-- Reflexão do Dia -->
    <section id="reflexao-do-dia" class="section">
      <h2 class="section-title">Reflexão do Dia</h2>
      <div id="reflexao-container" class="reflexao-container">
        <div class="loading"><div class="loading-spinner"></div></div>
      </div>
    </section>

    <!-- Aniversariantes -->
    <section id="aniversariantes" class="section">
      <h2 class="section-title">Aniversariantes do Mês</h2>
      <div id="aniversariantes-container" class="aniversariantes-container">
        <div class="loading"><div class="loading-spinner"></div></div>
      </div>
    </section>

    <!-- Férias -->
    <section id="ferias" class="section">
      <h2 class="section-title">Colaboradores em Férias</h2>
      <div class="ferias-container">
        <div id="ferias-grid-container" class="ferias-grid">
          <div class="loading"><div class="loading-spinner"></div></div>
        </div>
        <table class="ferias-table">
          <thead>
            <tr>
              <th>Colaborador</th>
              <th>Departamento</th>
              <th>Início</th>
              <th>Retorno</th>
            </tr>
          </thead>
          <tbody id="ferias-tbody">
            <tr>
              <td colspan="4">
                <div class="loading"><div class="loading-spinner"></div></div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <!-- CIPA -->
    <section id="cipa" class="section">
      <h2 class="section-title">CIPA</h2>
      <div id="cipa-container" class="cipa-container">
        <div class="loading"><div class="loading-spinner"></div></div>
      </div>
    </section>
  </main>

  <!-- FOOTER (será carregado via JS) -->
  <div id="footer-placeholder"></div>

  <!-- SCRIPTS -->
  <script>
    // 1) injeta menu e rodapé
    ['menu','footer'].forEach(file => {
      fetch(file + '.html')
        .then(r => r.text())
        .then(html => document.getElementById(file + '-placeholder').innerHTML = html);
    });

    // 2) configura data atual
    const hoje = new Date(),
          dia = hoje.getDate(),
          mes = hoje.getMonth(),
          ano = hoje.getFullYear(),
          meses = ['janeiro','fevereiro','março','abril','maio','junho','julho','agosto','setembro','outubro','novembro','dezembro'],
          hojePt = `${dia} de ${meses[mes]} de ${ano}`;

    document.getElementById('data-hoje-novidades').textContent = hojePt;

    // 3) função genérica fetch + JSON
    const BASE = 'https://cdn.jsdelivr.net/gh/PSRindustria/PortalPSR@main';
    async function fetchData(path) {
      try {
        const res = await fetch(`${BASE}/${path}`);
        if (!res.ok) throw new Error(res.status);
        return await res.json();
      } catch {
        return null;
      }
    }

    // 4) renderiza Novidades
    (async () => {
      const data = await fetchData('novidades.json'),
            c = document.getElementById('novidades-container');
      if (!data) {
        c.innerHTML = '<p>Erro ao carregar novidades.</p>';
        return;
      }
      c.innerHTML = '';
      data.forEach(n => {
        c.innerHTML += `
          <div class="novidade-card">
            <div class="novidade-img"><i class="${n.icone}"></i></div>
            <div class="novidade-content">
              <h3>${n.titulo}</h3>
              <div class="novidade-date"><i class="far fa-calendar-alt"></i> ${n.data}</div>
              <p>${n.conteudo||n.resumo}</p>
            </div>
          </div>`;
      });
    })();

    // 5) renderiza Reflexão com expand/collapse
    (async () => {
      const data = await fetchData('reflexaododia.json'),
            c = document.getElementById('reflexao-container');
      if (!data) {
        c.innerHTML = '<p>Erro ao carregar reflexão.</p>';
        return;
      }
      const key = `${String(dia).padStart(2,'0')}/${String(mes+1).padStart(2,'0')}/${ano}`,
            r = data.find(x => x.data === key);
      c.innerHTML = '';
      if (!r) {
        c.innerHTML = '<p>Sem reflexão para hoje.</p>';
        return;
      }
      const card = document.createElement('div');
      card.innerHTML = `
        <p class="reflexao-frase">“${r.frase}”</p>
        <p class="reflexao-autor">- ${r.autor}</p>
        <p class="reflexao-instrucao">Clique aqui para refletir</p>
        <div class="reflexao-extra">
          <p class="reflexao-texto">${r.reflexao}</p>
          <p class="reflexao-data">Reflexão: ${r.data}</p>
        </div>`;
      const extra = card.querySelector('.reflexao-extra'),
            instr = card.querySelector('.reflexao-instrucao');
      extra.style.display = 'none';
      instr.addEventListener('click', () => {
        extra.style.display = extra.style.display === 'none' ? 'block' : 'none';
      });
      c.appendChild(card);
    })();

    // 6) renderiza Aniversariantes
function formatarDataBr(dataBr) {
  const [dia, mes] = dataBr.split('/');
  const meses = [
    'janeiro','fevereiro','março','abril','maio','junho',
    'julho','agosto','setembro','outubro','novembro','dezembro'
  ];
  return `${dia} de ${meses[Number(mes) - 1]}`;
}
async function renderAniversariantes() {
  const data = await fetchData('aniversariantes.json');
  const container = document.getElementById('aniversariantes-container');
  container.innerHTML = '';

  // pega dia e mês de hoje em dois dígitos
  const hoje = new Date();
  const diaHoje = String(hoje.getDate()).padStart(2, '0');
  const mesHoje = String(hoje.getMonth() + 1).padStart(2, '0');

  // nomes dos meses para exibir "05 de maio"
  const nomesMes = [
    'janeiro','fevereiro','março','abril','maio','junho',
    'julho','agosto','setembro','outubro','novembro','dezembro'
  ];

  data.forEach(a => {
    // separa "DD/MM"
    const [dia, mes] = a.data.split('/');

    // monta o elemento card
    const card = document.createElement('div');
    card.className = 'aniversariante-card';

    // se for aniversário hoje, adiciona destaque
    if (dia === diaHoje && mes === mesHoje) {
      card.classList.add('destaque-hoje');
    }

    // converte para "DD de mês"
    const dataFormatada = `${dia} de ${nomesMes[Number(mes)-1]}`;

    card.innerHTML = `
      <div class="aniversariante-img">
        ${a.imagem
          ? `<img src="${a.imagem}" alt="${a.nome}">`
          : '<i class="fas fa-birthday-cake"></i>'}
      </div>
      <div class="aniversariante-info">
        <h3><i class="fas fa-birthday-cake"></i> ${a.nome}</h3>
        ${a.cargo ? `<p>${a.cargo}</p>` : ''}
        <p class="aniversariante-data">${dataFormatada}</p>
      </div>`;
    container.appendChild(card);
  });
}


    // 7) renderiza Férias
    (async () => {
      const data = await fetchData('ferias.json'),
            grid = document.getElementById('ferias-grid-container'),
            tb   = document.getElementById('ferias-tbody');
      if (!data) {
        grid.innerHTML = tb.innerHTML = '<p>Erro ao carregar férias.</p>';
        return;
      }
      grid.innerHTML = ''; tb.innerHTML = '';
      data.forEach(f => {
        grid.innerHTML += `
          <div class="ferias-card">
            <div class="ferias-card-header">
              <i class="fas fa-plane-departure ferias-card-icon"></i>
              <span>${f.colaborador}</span>
            </div>
            <p><strong>Período:</strong> ${f.inicio} - ${f.retorno}</p>
            <p>${f.departamento}</p>
          </div>`;
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${f.colaborador}</td>
                        <td>${f.departamento}</td>
                        <td>${f.inicio}</td>
                        <td>${f.retorno}</td>`;
        tb.appendChild(tr);
      });
    })();

    // 8) renderiza CIPA
    (async () => {
      const raw = await fetchData('cipa.json'),
            c = document.getElementById('cipa-container');
      if (!raw) {
        c.innerHTML = '<p>Erro ao carregar CIPA.</p>';
        return;
      }
      const list = Array.isArray(raw) ? raw : Object.values(raw);
      c.innerHTML = '';
      list.forEach(i => {
        c.innerHTML += `
          <div class="cipa-card">
            <div class="cipa-icon"><i class="${i.icone}"></i></div>
            <h3>${i.titulo||i.nome}</h3>
            <p>${i.conteudo||i.cargo_cipa||''}</p>
          </div>`;
      });
    })();
  </script>
</body>
</html>
